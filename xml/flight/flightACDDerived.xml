<!--  $Header: /nfs/slac/g/glast/ground/cvs/xmlGeoDbs/xml/flight/flightACDDerived.xml,v 1.8 2003/08/01 18:45:05 jrb Exp $ -->
      <derCategory name="derACD" save="true" >
        <overview>Derived constants specific to the ACD</overview>

        <const name="ACDSideSupportThick">
          <notes>Thickness of core + face sheets for side support</notes>
          <add>
            <refer refTo="ACDSideCoreThickness" />
            <refer refTo="ACDFaceThickness" />
            <refer refTo="ACDFaceThickness" />
          </add>
        </const>

        <const name="ACDTopSupportThick">
          <notes>Thickness of core + face sheets for top support</notes>
          <add>
            <refer refTo="ACDTopCoreThickness" />
            <refer refTo="ACDFaceThickness" />
            <refer refTo="ACDFaceThickness" />
          </add>
        </const>


        <const name="ACDSidesGap">
          <notes>Min. distance between tiles of the two sides || to x-axis
                or equivalently of the two sides || to y-axis.
                Use displacement info for top row of tiles from from 3-d model
          </notes>
          <minus>
            <mul>
              <refer refTo="sideTileR0_dt" />
              <const value="2" uType="count" />
            </mul>
            <refer refTo="tileThickness" />
          </minus>
        </const>


        <const name="ACDTopTransverse" >
          <notes>Transverse dimension of envelope which will contain
          ACD top tiles and ribbons.  As of July 2003, just set to 
          value large enough to include all top tiles as positioned
          from 3-d model.  From this model there is an approx. 3 mm
          (actually 3.3)   gap between side tiles (top row) and top tiles 
        </notes>
          <minus>
            <refer refTo="ACDSidesGap" />
            <mul>
              <refer refTo="ACDSideTopTileGap" />
              <const value="2" uType="count" />                  
            </mul>
          </minus>          
        </const>

        <const name="ACDTop_z" >
          <notes>Z dimension of envelope which will contain
          ACD top tiles and ribbons (1 nov 2002)
          As of July, '03, simply use information from 3-d model
          about location of top of topmost tiles and top of 
          support structure to compute this.</notes>
          <minus>
            <refer refTo="ACDTileMaxZ" />
            <refer refTo="ACDTopSupportMaxZ" />
          </minus>
        </const>

        <const name="ACDTopZHalf" >
          <notes>for convenience</notes>
          <half>
            <refer refTo="ACDTop_z" />
          </half>
        </const>


        <const name="ACDTop_d" >
          <notes>Z displacement of top ACD relative to Ritz origin.
                As of July, 2003, get frontmost tile position from
                3-d model version 6-23-03; compute from there.</notes>
          <minus>
            <refer refTo="ACDTileMaxZ" />
            <refer refTo="ACDTopZHalf" />
          </minus>
        </const>

        <const name="ACDSideThickness">
          <notes>This isn't really correct.  If overlapping and
            slant are taken into account, ACDSideThickness is
            over twice this value. (1 nov 2002)</notes>
          <refer refTo="tileThickness" />
        </const>

        <const name="ACDTotalX">
          <notes>Total extent in X of entire collection of ACD pieces,
                 plus a millimeter for good luck (4 nov 2002) </notes>
          <add>
            <refer refTo="ACDSidesGap" />
            <refer refTo="ACDSideThickness" />
            <refer refTo="ACDSideThickness" />
            <const value="1.0" />
          </add>
        </const>

        <const name="ACDTotalY">
          <notes>Total extent in Y of entire collection of ACD pieces</notes>
          <refer refTo="ACDTotalX" />
        </const>

        <const name="ACDTotalTransSide" >
          <notes>transverse length of collection of ACD side tiles,
              e.g those alone -X side of instrument. Could be
              used for envelope volume. Is also equal to transverse
              dimension of the single tile in the bottom  row.
              (1 nov 2002).  July '03.  Now compute as sum of tranverse
              dimensions of tiles in R0, columns 0-5, plus gaps</notes>
          <add>
            <refer refTo="sideTileTransLesser" />
            <refer refTo="sideTileTransGreater" />
            <refer refTo="sideTileTransMid" />
            <refer refTo="sideTileTransMid" />
            <refer refTo="sideTileTransMid" />
            <mul>
              <const value="4" uType="count" />
              <refer refTo="sideHorizontalGap" />
            </mul>
          </add>
        </const>

 <!-- For current approximate model, transverse displacement of a
      side ACD face = transverse displacement of row 0. -->
        <const name="tileSide_dt">
          <notes>Transverse (perpendicular to plane of face) displacement
                 of side face of ACD</notes>
          <refer refTo="sideTileR0_dt" />
        </const>

        <const name="tileSide_dtn">
          <notes>Transverse (perpendicular to plane of face) displacement
                 of side face of ACD for "negative" faces</notes>
          <uminus>
            <refer refTo="tileSide_dt" />
          </uminus>
        </const>

 <!-- Ribbon dimensions.   An xRibbon is one more or less contained in
      a plane of constant x (perp. to x axis) and similarly for yRibbon. 
      In current (nov 2002) model yRibbons are divided into 5 segments
      along top; xRibbons have only a single top segment
  -->
         
        <const name="xRibbonTop_l">
          <notes>These ribbons run the full distance across ACDTop
              (actually more, but that's all that will fit)</notes>
          <refer refTo="ACDTopTransverse" />
        </const>

        <!-- There are 3 different possible lengths for bits of X ribbon:
             one for ribbon segments under the central tiles, one for 
             ribbon segments under "mid" tiles (columns 1 and 3) and one
             for ribbon segments under the outer columns (0 and 4).     -->

<!--
        <const name="yRibbonTopCent_l">
          <notes>length of ribbon segments running under the central column
            of tiles</notes>
          <add>
            <refer refTo="topTileXCentral_l" />
            <refer refTo="ribbonOverlap" />
            <refer refTo="ribbonOverlap" />
          </add>
        </const>

        <const name="yRibbonTopMid_l">
          <notes>length of ribbon segments running under columns 1,3
            of top tiles</notes>
          <minus>
            <add>
              <refer refTo="topTileXMid_l" />
              <refer refTo="ribbonOverlap" />
            </add>
            <add>
              <refer refTo="topOverlap" />
              <refer refTo="ribbonGap" />
            </add>
          </minus>
        </const>

        <const name="yRibbonTopEdge_l">
          <notes>length of ribbon segments running under columns 0,4
            of top tiles</notes>
          <minus>
            <refer refTo="topTileXEdgeTotal_l" />
            <add>
              <refer refTo="topOverlap" />
              <refer refTo="ribbonGap" />
            </add>
          </minus>
        </const>            

-->

        <!-- Old stuff having to do with counts, ranges of id fields
             is probably still useful -->
        <const name="XTopTileMax" uType="count" type="int">
          <notes>Convenience for idField definitons</notes>
          <minus>
            <refer refTo="numXTopTiles" />
            <const value="1.0" />
          </minus>
        </const>

        <const name="YTopTileMax" uType="count" type="int">
          <notes>Convenience for idField definitons</notes>
          <minus>
            <refer refTo="numYTopTiles" />
            <const value="1" uType="count" />
          </minus>
        </const>


        <const name="ACDShortRowMin" uType="count"  type="int">
          <notes>row number of first short ACD side row</notes>
          <add>
            <refer refTo="ACDLongRowMax" />
            <const value="1" uType="count" />
          </add>
        </const>

        <const name="ACDShortRowMax" uType="count"  type="int">
          <notes>row number of last short ACD side row</notes>
          <minus>
            <refer refTo="numSideRows" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="ACDShortMaxCol" uType="count" type="int">
          <notes>Column number of last tile in a short row</notes>
          <minus>
            <refer refTo="numPerSideRowShort" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="ACDLongMaxCol" uType="count" type="int">
          <notes>Column number of last tile in a long row</notes>
          <minus>
            <refer refTo="numPerSideRowLong" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="ACDSide_z" >
          <notes>Total height of an ACD side of tiles 
              (tiles plus gaps)</notes>
          <add>
            <refer refTo="sideTileHeight0" />
            <refer refTo="sideTileHeight1" />
            <refer refTo="sideTileHeight2" />
            <refer refTo="sideTileHeight3" />
            <mul>
              <minus>
                <refer refTo="numSideRows" />
                <const value="1" uType="count" />
              </minus>
              <refer refTo="sideVerticalGap" />
            </mul>
          </add>
        </const>

        <const name="ribbonHalfThickness" >
          <notes>for convenience</notes>
          <half>
            <refer refTo="ribbonThickness" />
          </half>
        </const>

        <const name="tileHalfThickness" >
          <notes>for convenience</notes>
          <half>
            <refer refTo="tileThickness" />
          </half>
        </const>
 
<!-- heights of tiles on both X and Y sides are the same: -->
        <const name="sideTileRow0_d">
          <notes>Z-Displacement for top row (row 0) of side tiles (X and Y),
                relative to the center of a box containing the side</notes>
          <half>
            <minus>
              <refer refTo="ACDSide_z" />
              <refer refTo="sideTileHeight0" />
            </minus>
          </half>
        </const>

        <const name="sideTileRow1_d">
          <notes>Displacement for row 1 side tiles (X and Y)</notes>
          <minus>
            <refer refTo="sideTileRow0_d" />
            <add>
              <refer refTo="sideVerticalGap" />
              <half>
                <add>
                  <refer refTo="sideTileHeight1" />
                  <refer refTo="sideTileHeight0" />
                </add>
              </half>
            </add>
          </minus>
        </const>

        <const name="sideTileRow2_d">
          <notes>Displacement for row 2 side tiles (X and Y)</notes>
          <minus>
            <refer refTo="sideTileRow1_d" />
            <add>
              <refer refTo="sideVerticalGap" />
              <half>
                <add>
                  <refer refTo="sideTileHeight2" />
                  <refer refTo="sideTileHeight1" />
                </add>
              </half>
            </add>
          </minus>
        </const>

        <const name="sideTileRow3_d">
          <notes>Displacement for row 3 side tiles (X and Y)</notes>
          <minus>
            <refer refTo="sideTileRow2_d" />
            <add>
              <refer refTo="sideVerticalGap" />
              <half>
                <add>
                  <refer refTo="sideTileHeight3" />
                  <refer refTo="sideTileHeight2" />
                </add>
              </half>
            </add>
          </minus>
        </const>


<!-- Additionally need to compute bunch of displacements to be used
     in constructing ACD top:

     For tiles, 
          need 3 different Z displacements,
                    topTileCent_dz
                    topTileMid_dz
                    topTileEdge_dz
-->
        <const name="topTileEdge_dz">
          <notes>Displacement w.r.t. center of ACD top envelope of
                highest tiles, those in col. 0 and 4</notes>
          <minus>
            <refer refTo="ACDTopZHalf" />
            <refer refTo="tileHalfThickness" />
          </minus>
        </const>

        <const name="topTileMid_dz">
          <notes>Displacement w.r.t. center of ACD top envelope of
                tiles in cols 1 and 3</notes>
          <minus>
            <refer refTo="topTileEdge_dz" />
            <add>
              <refer refTo="tileThickness" />
              <refer refTo="topTileOuterZGap" />
            </add>
          </minus>
        </const>

        <const name="topTileCent_dz">
          <notes>Displacement w.r.t. center of ACD top envelope of
                tiles in col 2</notes>
          <minus>
            <refer refTo="topTileMid_dz" />
            <add>
              <half>
                <add>
                  <refer refTo="tileThickness" />
                  <refer refTo="tileCenterThickness" />
                </add>
              </half>
              <refer refTo="topTileInnerZGap" />
             </add>
          </minus>
        </const>

<!--          2 X displacements and their negatives
                    topTileEdge_dx, _dxn
-->
        <const name="topTileMid_dx" >
          <notes>X displacement of top tiles in column 3 </notes>
          <minus>
            <half>
              <add>
                <refer refTo="topTileXCentral_l" />
                <refer refTo="topTileXMid_l" />
              </add>
            </half>
            <refer refTo="topOverlap" />
          </minus>
        </const>
          
        <const name="topTileMid_dxn" >
          <notes>X displacement of top tiles in column 1 </notes>
          <uminus>
            <refer refTo="topTileMid_dx" />
          </uminus>
        </const>

        <const name="topTileEdge_dx" >
          <notes>X displacement of top tiles in column 4 </notes>
          <add>
            <refer refTo="topTileMid_dx" />
            <half>
              <add>
                <refer refTo="topTileXMid_l" />
                <refer refTo="topTileXEdge_l" />
              </add>
            </half>
            <uminus>
              <refer refTo="topOverlap" />
            </uminus>
          </add>
        </const>

        <const name="topTileEdge_dxn" >
          <notes>X displacement of top tiles in column 0 </notes>
          <uminus>
            <refer refTo="topTileEdge_dx" />
          </uminus>
        </const>

<!--   NOTE   Need to review y displacements for July 03 -->
<!--          2 Y displacements and their negatives
                    topTileEdge_dy, _dyn
                    topTileMid_dy, _dyn   -->
 
        <const name="topTileMid_dy" >
          <notes>Y displacement of tiles in row 3</notes>
          <add>
            <half>
               <add>
                 <refer refTo="topTileYCentral_l" />
                 <refer refTo="topTileYMid_l" />
               </add>
            </half>
            <refer refTo="topTileGap" />
          </add>
        </const>

        <const name="topTileMid_dyn" >
          <notes>Y displacement of tiles in row 1</notes>
          <uminus>
            <refer refTo="topTileMid_dy" />
          </uminus>
        </const>

        <const name="topTileEdge_dy" >
          <notes>Y displacement of tiles in row 4</notes>
          <add>
            <refer refTo="topTileMid_dy" />
            <half>
               <add>
                 <refer refTo="topTileYEdge_l" />
                 <refer refTo="topTileYMid_l" />
               </add>
            </half>
            <refer refTo="topTileGap" />
          </add>
        </const>
          
        <const name="topTileEdge_dyn" >
          <notes>Y displacement of tiles in row 0</notes>
          <uminus>
            <refer refTo="topTileEdge_dy" />
          </uminus>
        </const>

<!--
     For the 4 Y ribbons (ribbons in plane || to Y axis)
          one Z displacement
               topXRibbon_dz
          2 X displacements and their negatives
               topXRibbonOuter_dx, _dxn
               topXRibbonInner_dx, _dxn
         The Z and X displacements aren't very important since the Y ribbons
         are only on top to connect the side pieces, not to detect 
         anything.  Originally, for simplicity,
         put Y ribbons along bottom of envelope volume with
         displacements in X equal to the ones used for top tiles. 

         3-d model bears out the Z guess.  X displacements should
         be the same for top segments as for the same ribbons
         running down the sides; that is, they're governed by
         spacing of side tiles.
-->

         <const name="topXRibbon_dz" >
           <notes>Z displacement for long ribbon segments running || to
                 Y-axis along top.</notes>
           <minus>
             <refer refTo="ribbonHalfThickness" />
             <refer refTo="ACDTopZHalf" />
           </minus>
         </const>

<!-- Note following displacements are relative to origin, not
     relative to dovetailed ACD side.  This is OK since even
     on sides ribbons don't partake of dovetailing.  Gaps between
     tiles are still placed symmetrically w.r.t. origin. Dovetailing
     is handled by different widths of tiles in columns 0 and 4. -->
         <const name="xRibbonInner_dx" >
           <notes> x displacement of  Y ribbon #2 </notes>
           <half>
             <add>
               <refer refTo="ribbonThickness" />
               <refer refTo="sideTileTransMid" />
             </add>
           </half>
         </const>

         <const name="xRibbonOuter_dx" >
           <notes> x displacement of Y ribbon #3 </notes>
           <add>
             <refer refTo="xRibbonInner_dx" />
             <refer refTo="sideTileTransMid" />
             <refer refTo="ribbonThickness" />
           </add>
         </const>

         <const name="xRibbonOuter_dxn" >
           <notes>  x displacement of Y ribbon #0 </notes>
           <uminus>
             <refer refTo="xRibbonOuter_dx" />
           </uminus>
         </const>

         <const name="xRibbonInner_dxn" >
           <notes> x displacement of Y ribbon #1 </notes>
           <uminus>
             <refer refTo="xRibbonInner_dx" />
           </uminus>
         </const>

         <const name="ribbonsSideWidth">
           <notes>Width of envelope volume to contain 4 side
                  ribbons</notes>
           <add>
             <refer refTo="xRibbonOuter_dx" />
             <refer refTo="xRibbonOuter_dx" />
             <refer refTo="ribbonWidth" />
           </add>
         </const>

         <const name="ribbonsSideZ">
           <notes>Height of envelope volume to contain 4 side
                  ribbons. The envelope extends from bottom of 
                  ACDTop volume to back edge of side tiles.</notes>
           <minus>
              <minus>
                <refer refTo="ACDTop_d" />
                <refer refTo="ACDTopZHalf" />
              </minus>
              <minus>
                <refer refTo="tileSide_dz" />
                <half>
                  <refer refTo="ACDSide_z" />
                </half>
              </minus>
            </minus>
          </const>
                
<!--
     For the 20 X ribbon segments
          3 Z displacements
               topYRibbonCent_dz
               topYRibbonMid_dz
               topYRibbonEdge_dz
          2 X displacements and their negatives
               topYRibbonMid_dx, _dxn
               topYRibbonEdge_dx, _dxn
          2 Y displacements and their negatives
               topYRibbonInner_dy, _dyn
               topYRibbonOuter_dy, _dyn
 -->
<!-- compute Z-displacements from the ones for top tiles -->
<!--
        <const name="topYRibbonEdge_dz">
          <notes>Z displacement for outer segments (1 and 5) of 
                 top ribbons || to x-axis </notes>
          <minus>
            <refer refTo="topTileEdge_dz" />
            <add>
              <refer refTo="tileHalfThickness" />
              <refer refTo="ribbonHalfThickness" />
              <refer refTo="ribbonGap" />
            </add>
          </minus>
        </const>

        <const name="topYRibbonMid_dz">
          <notes>Z displacement for mid segments (2 and 4) of 
                 top ribbons || to x-axis </notes>
          <minus>
            <refer refTo="topYRibbonEdge_dz" />
            <refer refTo="tileThickness" />
          </minus>
        </const>

        <const name="topYRibbonCent_dz">
          <notes>Z displacement for central segment (3) of 
                 top ribbons || to x-axis </notes>
          <minus>
            <refer refTo="topYRibbonMid_dz" />
            <quo>
              <add>
                <refer refTo="tileThickness" />
                <refer refTo="tileCenterThickness" />
              </add>
              <const value="2" uType="count" />
            </quo>
          </minus>
        </const>
-->

        <!-- go to edge of central tile, add ribbon gap and half our length -->
<!--
        <const name="topYRibbonMid_dx" >
          <notes>x-displacement of segment 4 </notes>
          <add>
            <refer refTo="ribbonGap" />
            <quo>
              <add>
                <refer refTo="topTileXCentral_l" />
                <refer refTo="yRibbonTopMid_l" />
              </add>
              <const value="2" uType="count" />
            </quo>
          </add>
        </const>

        <const name="topYRibbonMid_dxn" >
          <notes>x-displacement of segment 2 </notes>
          <uminus>
            <refer refTo="topYRibbonMid_dx" />
          </uminus>
        </const>
-->

        <!-- go to center of mid tile, add half tile length (to get
           to edge) half our length and finally ribbon gap -->

<!--
        <const name="topYRibbonEdge_dx" >
          <notes>x-displacement of segment 5 </notes>
          <add>
            <refer refTo="topTileMid_dx" />
            <quo>
              <add>
                <refer refTo="topTileXMid_l" />
                <refer refTo="yRibbonTopEdge_l" />
              </add>
              <const value="2" uType="count" />
            </quo>
            <refer refTo="ribbonGap" />
          </add>
        </const>

        <const name="topYRibbonEdge_dxn" >  
          <notes>x-displacement of segment 1 </notes>
          <uminus>
            <refer refTo="topYRibbonEdge_dx" />
          </uminus>
        </const>

        <const name="topYRibbonInner_dy" >
          <notes> Y displacement for segments belonging to Y-ribbon 2</notes>
          <quo>
            <add>
              <refer refTo="topTileYCentral_l" />
              <refer refTo="topTileGap" />
            </add>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="topYRibbonInner_dyn" >
          <notes> Y displacement for segments belonging to Y-ribbon 1</notes>
          <uminus>
            <refer refTo="topYRibbonInner_dy" />
          </uminus>
        </const>

        <const name="topYRibbonOuter_dy" >
          <notes>Y displacement for segments belonging to last Y-ribbon (3) 
          </notes>
          <add>
            <refer refTo="topYRibbonInner_dy" />
            <refer refTo="topTileYMid_l" />
            <refer refTo="topTileGap" />
          </add>
        </const>

        <const name="topYRibbonOuter_dyn" >
          <notes>Y displacement for segments belonging to first Y-ribbon (0)
          </notes>
          <uminus>
            <refer refTo="topYRibbonOuter_dy" />
          </uminus>
        </const>
-->


        <const name="ACDSideDovetail_d" >
          <notes>Side tiles and tapes on sides parallel to X-axis
                 have a displacement in X of this amount. Those
                 on sides || to Y are displaced in Y the same amount</notes>
          <uminus>
            <quo>
              <add>
                <refer refTo="tileThickness" />
                <refer refTo="topTileGap" />
              </add>
              <const value="2" uType="count" />
            </quo>
          </uminus>
        </const>

        <const name="ACDSideDovetail_dn" >
          <notes>Dovetail displacement for "negative" ACD sides</notes>
          <uminus>
            <refer refTo="ACDSideDovetail_d" />
          </uminus>
        </const>


<!-- displacements for ACD support pieces in their negative incarnations -->
<!-- constants used for strucutural pieces -->
<!--  Old method obsolete as of July 03.  Instead get primary dimension from
   3-d model.  Turns out acd top support doesn not cover sides;
   it nests between them. -->


        <const name="ACDSideSupport_dtn">
          <notes>Transverse (x or y) distance of support side from 
                 Ritz origin, negative</notes>
          <uminus>
            <refer refTo="ACDSideSupport_dt" />
          </uminus>
        </const>

        <const name="ACDSideSupport_dDovetailn">
          <notes>Negative dovetail distance for those sides 
                 that need it.</notes>
          <uminus>
            <refer refTo="ACDSideSupport_dDovetail" />
          </uminus>
        </const>


      </derCategory>

<!-- All of above has been reviewed as of 31 July 2003 -->




