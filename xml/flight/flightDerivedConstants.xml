<!-- $Header: /nfs/slac/g/glast/ground/cvs/xmlGeoDbs/xml/flight/flightDerivedConstants.xml,v 1.19 2007/03/01 19:39:02 jrb Exp $ -->
    <derived>
      &CALDerived;

      &TKRDerived;

      &extraDerived;

      <derCategory name="misc">
        <overview>Stuff that doesn't fit elsewhere</overview>

    <!-- a couple convenience numbers -->
        <const name="xNumM1" uType="count" type="int">
          <notes>Convenience number</notes>
          <minus>
            <refer refTo="xNum" />
            <const value="1" uType="count" />
          </minus>
        </const>
        <const name="yNumM1" uType="count" type="int">
          <notes>Convenience number</notes>
          <minus>
            <refer refTo="yNum" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="maxLog" uType="count" type="int" >
          <notes>Upper limit on CsI log idField values</notes>
          <minus>
            <refer refTo="nCsIPerLayer" />
            <const value="1" uType="count" />
          </minus>
        </const>


<!-- Essentially stay-clear for full array of trackers.  Grid may
     be wider. -->
	<const name="towersTotalX">
          <notes>Meant to be X width of the array of tracker towers;
           doesn't include grid</notes>
          <add>
            <mul>
              <refer refTo="xNumM1" />
              <refer refTo="towerPitch" />
            </mul>
            <refer refTo="TKRTransverseStayClear" />
          </add>
        </const>

	<const name="towersTotalY">
          <notes>Meant to be Y width of the array of tracker towers;
           doesn't include grid</notes>
          <refer refTo="towersTotalX" />
        </const>

<!-- Compute total Z by adding up
            CAL height
            cal-tracker gap
            (ntray-1)* inter-tray spacing
            Z of top half of top tray, bottom half of bottom tray
              (which is the same as Z of a single outer tray)
-->
	<const name="towersTotalZ">  
          <notes>Height of cal (stay clear) + height of tracker (S-C) 
                      + gap between.
                  Also add gap between CAL and
          </notes>
          <add>
            <refer refTo="CALVertStayClear" />
            <refer refTo="NADGridFlangeZ" />
            <refer refTo="CALGridFrameGap" />
            <refer refTo="TKRVertStayClear" />
          </add>                               
        </const>

        <const name="towersTotalHalfZ">
          <notes>Convenience</notes>
          <quo>
            <refer refTo="towersTotalZ" />
            <const value="2" uType = "count" />
          </quo>
        </const>


        <const name="oneNoTKR_z" >
          <notes> Height of a CAL-only tower (CAL + grid)</notes>
          <add>
            <refer refTo="NADGridFlangeZ" />
            <refer refTo="CALGridFrameGap" />
            <refer refTo="CALVertStayClear" />
          </add>
        </const>

        <const name="oneNoTKR_dz" >
          <notes> Z-displacement of a oneCalTower (no tracker) w.r.t 
                  allTowers volume.  It's at the bottom </notes>
          <half>
            <minus>
              <refer refTo="oneNoTKR_z" />
              <refer refTo="towersTotalZ" />
            </minus>
          </half>
        </const>

        <const name="CAL_dz" >
          <notes>Offset of CAL stay-cleaar within single-tower volume.
                It's just below flange and min. 1.5 mm gap.
                </notes>
          <minus>
            <refer refTo="towersTotalHalfZ" />
            <add>
              <refer refTo="TKRVertStayClear" />
              <refer refTo="CALGridFrameGap" />
              <refer refTo="NADGridFlangeZ" />
              <half>
                <refer refTo="CALVertStayClear" />
              </half>
            </add>
          </minus>
        </const>

        <const name="TKR_dz" >
          <notes>Offset of TKR within single-tower volume</notes>
          <minus>     
            <refer refTo="towersTotalHalfZ" />
              <half>
                <refer refTo="TKRVertStayClear" />
              </half>
          </minus>
        </const>
        
         <const name="TKRFudge_dz" >
          <notes> Extra offset to get TKR bottom to touch grid.
          Depends on TkrTotalZ, which is entered by hand.
          This may go away if geometry can learn to do this by itself.</notes>
          <half>
            <minus>
              <refer refTo="TKRTotalZ" />
              <refer refTo="TKRVertStayClear" />
            </minus>
          </half>
        </const>
     
        <const name="gridFlange_dz">
          <notes>Z-Offset of grid flange pieces within single-tower volume.
          </notes>
          <minus>
            <refer refTo="towersTotalHalfZ" /> <!-- start at top -->
            <add>
              <refer refTo="TKRVertStayClear" />
              <quo>
                <refer refTo="NADGridFlangeZ" />
                <const value="2" uType="count" />
              </quo>
            </add>
          </minus>
        </const>

        <const name="gridWeb_dz" >
          <notes>Z-Offset of grid web pieces within single-tower volume</notes>
          <minus>
            <refer refTo="gridFlange_dz" />
            <quo>
              <add>
                <refer refTo="NADGridFlangeZ" />
                <refer refTo="NADGridWebZ" />
              </add>
              <const value="2" uType="count" />
            </quo>
          </minus>
        </const>

        <const name="gridFlange_dt" >
          <notes>Transverse offset of per-tower grid flange pieces</notes>
          <quo>
            <minus>
              <refer refTo="towerPitch" />
              <refer refTo="NADGridFlangeInnerHalf"/>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="gridFlange_dtn" >
          <notes>Negative transverse offset of per-tower grid flange 
                 pieces</notes>
          <uminus>
            <refer refTo="gridFlange_dt" />
          </uminus>
        </const>

        <const name="gridWeb_dt" >
          <notes>Transverse offset of per-tower grid web pieces</notes>
          <quo>
            <minus>
              <refer refTo="towerPitch" />
              <refer refTo="NADGridWebInnerHalf"/>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>
        
        <const name="gridWeb_dtn" >
          <notes>Negative transverse offset of per-tower grid web pieces
          </notes>
          <uminus>
            <refer refTo="gridWeb_dt" />
          </uminus>
        </const>
        
        <const name="LATGridFlange_dt" >
          <notes>Transverse offset of LAT-wide grid flange pieces</notes>
          <quo>
            <minus>
              <refer refTo="NADGridFlangeWidth" />
              <refer refTo="NADGridFlangeOutsideWidth" />
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>
        
        <const name="LATGridFlange_dtn" >
          <notes>Neg. transverse offset of LAT-wide grid flange pieces</notes>
          <uminus>
            <refer refTo="LATGridFlange_dt" />
          </uminus>
        </const>
        
        <const name="LATGridWeb_dt" >
          <notes>Transverse offset of LAT-wide grid web pieces</notes>
          <quo>
            <minus>
              <refer refTo="NADGridWebWidth" />
              <refer refTo="NADGridWebOutsideWidth" />
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>
        
        <const name="LATGridWeb_dtn" >
          <notes>Neg. transverse offset of LAT-wide grid web pieces</notes>
          <uminus>
            <refer refTo="LATGridWeb_dt" />
          </uminus>
        </const>
      </derCategory>

      &ACDDerived;


      <derCategory name="derGlobal" save="true" >
        <overview>A few more constants needed for the outermost 
                 LAT compositions</overview>
        <const name="LATX" >
          <notes>X-dimension of an envelope for the LAT,
                not including thermal blanket</notes>
          <refer refTo="ACDTotalX" />
        </const>
        <const name="LATY" >
          <notes>Y-dimension of an envelope for the LAT,
                 not including thermal blanket</notes>
          <refer refTo="ACDTotalY" />
        </const>

        <const name="LATZ" >
          <notes>Z-dimension of an envelope for the LAT,
                 not including thermal blanket</notes>
          <max>
            <refer refTo="ACDSide_z" />
            <add>
              <refer refTo="sideOverlap" />
              <refer refTo="ACDTop_z" />
              <refer refTo="ACDTopSupportThick" />
                 <!-- Guess at standoff value  -->
              <refer refTo="ACDTKRStayClear" />
              <refer refTo="towersTotalZ" />
            </add>
          </max>
        </const>

        <const name="bigXZDim" >
          <notes>Something big enough (for X and Z) to position 
                 everything inside,
                 with origin where it should be, at the very front
                 of the grid.</notes>
          <mul>
            <const value="2" uType="count" />
            <max>
              <add>
                <refer refTo = "towersTotalZ" />
                <refer refTo = "NADSpacecraftZ" />
              </add>
              <refer refTo = "ACDTotalX" />
            </max>
          </mul>
        </const>
        
        <const name="biggerZDim" >
          <notes> this is to make room for moving the LAT around in z, 
            to look for  bad hardwired consts. The formula is:
                    biggerZDim = bigXZDim + 2* abs(globalOffset_dz)</notes>
          <add>
            <refer refTo = "bigXZDim" />
            <mul>
              <max>
                <refer refTo = "globalOffset_dz" />
                <uminus>
                  <refer refTo = "globalOffset_dz" /> 
                </uminus>
              </max>
              <const value="2" uType="count" />
            </mul>
          </add>
        </const>

        <const name="NADTotalPanelLen" >
          <notes>Length of panel proper plus connecting rod</notes>
          <add>
            <refer refTo="NADSolarRodLength" />
            <refer refTo="NADSolarPLength" />
          </add>
        </const>


        <const name="bigYDim" >
          <notes>Something big enough to use as Y dimension of
                 envelope (takes into account solar panels)
                 </notes>
          <mul>
            <const value = "2" uType="count" />
            <add>
              <refer refTo="NADTotalPanelLen" />
              <const value = "100" />          
              <refer refTo="NADSpacecraftR" />
            </add>
          </mul>
        </const>
             

        <const name="solarPanel_dy" >
          <notes>y-displacement of panel-only part of solar panel w.r.t.
                 envelope including panel and connecting rod</notes>
          <quo>
            <refer refTo="NADSolarRodLength" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="solarRod_dy" >
          <notes>y-displacement of rod part of solar panel w.r.t.
                 envelope including panel and connecting rod</notes>
          <uminus>
            <quo>
              <refer refTo="NADSolarPLength" />
              <const value="2" uType="count" />
            </quo>
          </uminus>
        </const>

        <const name="solarPanelEnv_dy" >
          <notes>y-displacement of entire (+Y) solar panel envelope w.r.t.
                 Ritz origin.</notes>
          <add>
            <refer refTo="NADSpacecraftR" />
            <quo>
              <refer refTo="NADTotalPanelLen" />
              <const value="2" uType="count" />
            </quo>
          </add>
        </const>
        
        <const name="solarPanelEnv_dyn" >
          <notes>y-displacement of entire (-Y) solar panel envelope w.r.t.
                 Ritz origin.</notes>
          <uminus>
            <refer refTo="solarPanelEnv_dy" />
          </uminus>
        </const>

        <!-- Put solar panels just halfway down the spacecraft -->
        <const name="solarPanelEnv_dz" >
          <notes>z-displacement of entire solar panel envelope w.r.t.
                 Ritz origin.</notes>
          <refer refTo="spacecraft_dz" />
        </const>

        <const name="solarPanelSi_dz" >
          <notes>z-displacement of Si part of solar panel w.r.t.
                 envelope including panel and connecting rod</notes>
          <quo>
            <refer refTo="NADSolarCoreThick" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="solarPanelCore_dz" >
          <notes>z-displacement of core part of solar panel w.r.t.
                 envelope including panel and connecting rod</notes>
          <uminus>
            <quo>
              <refer refTo="NADSolarSiThick" />
              <const value="2" uType="count" />
            </quo>
          </uminus>
        </const>
          

        <const name="NADSolarRodDiam" >
          <notes>Diameter of rods connecting solar panels to spacecraft</notes>
          <add>
            <refer refTo="NADSolarRodR" />
            <refer refTo="NADSolarRodR" />
          </add>
        </const>

        <const name="LATZHalf" >
          <notes>convenience</notes>
          <quo>
            <refer refTo="LATZ" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="towersTrans" >
          <notes>Transverse dimension of envelope containing the towers
          </notes>
          <mul>
            <refer refTo="towerPitch" />
            <const value="4" uType="count" />
          </mul>
        </const>
            
        <const name="innerTowers_dt" >
          <notes>Transverse displacement of towers in row (column) 2</notes>
          <half>
            <refer refTo="towerPitch" />
          </half>
        </const>

        <const name="outerTowers_dt" >
          <notes>Transverse displacement of towers in row (column) 3</notes>
          <add>
            <refer refTo="towerPitch" />
            <refer refTo="innerTowers_dt" />
          </add>
        </const>

        <const name="innerTowers_dtn" >
          <notes>Transverse displacement of towers in row (column) 1 </notes>
          <uminus>
            <refer refTo="innerTowers_dt" />
          </uminus>
        </const>

        <const name="outerTowers_dtn" >
          <notes>Transverse displacement of towers in row (column) 0 </notes>
          <uminus>
            <refer refTo="outerTowers_dt" />
          </uminus>
        </const>

        <const name="towers_dz" >
          <notes>Displacement necessary to get towers origin in the
                 right place, namely at the front face of the grid
                 **Decreased by gap between CAL and TKR, nearly the
                   same as grid flange height, as of 29 Apr 2003**
                 </notes>
          <minus>
            <refer refTo="towersTotalHalfZ" />
            <add>
              <refer refTo="CALVertStayClear" />
              <refer refTo="NADGridFlangeZ" />
              <refer refTo="CALGridFrameGap" />
            </add>
          </minus>
        </const>

        <const name="spacecraft_dz">
          <notes>Z displacement of spacecraft relative to Ritz origin.
                It goes immediately under the 2nd layer of LAT electronics.
                All the modules in this layer have samae offset and
                same z-dimension</notes>
          <minus>
            <refer refTo="NAD_LAT_L2Electronics_dz" />
            <add>
<!--
              <refer refTo="NADGridFlangeZ" />
              <refer refTo="CALGridFrameGap" />
              <refer refTo="CALVertStayClear" />
              <refer refTo="NADSpacecraftGap" />
-->           
              <half>
                <refer refTo="NADpdu_z" />
              </half>
              <half> 
                 <refer refTo="NADSpacecraftZ" />
              </half>
            </add>
          </minus>
        </const>

<!-- have to do analogous 5 constants for side tile locations -->

        <const name="tileSide_dz">
          <notes>displacement in z of side tiles rel. to Ritz origin.
            Compute relative to ACDTop_d.  Find coordinate of top of
            ACD side, then subtract half side height.
          </notes>
          <minus>
            <add>
              <refer refTo="ACDTop_d" />
              <refer refTo="sideOverlap"/>
              <half>
                <refer refTo="ACDTop_z"/>
              </half>
            </add>               
            <half>
               <refer refTo="ACDSide_z" />
            </half>
          </minus>
        </const>


        <const name="ribbonsSide_dz">
          <notes>displacement in z of side ribbons rel. to Ritz origin.
           Ribbons go down as far as tile sides but don't go up quite as
           high.</notes>
          <minus>
            <refer refTo="tileSide_dz" />
            <half>
              <minus>
                <refer refTo="ACDSide_z" />
                <refer refTo="ribbonsSideZ" />
              </minus>
            </half>
          </minus>
        </const>

        <const name="ribbonsSide_dt">
          <notes>Transverse displacement from origin of a side's worth
               of ribbons.  Place them in an idealized position right
               next to side tiles </notes>
          <minus>
            <refer refTo="tileSide_dt" />
            <half>
              <add>
                <refer refTo="tileThickness" />
                <refer refTo="ribbonThickness" />
              </add>
            </half>
          </minus>
        </const>

        <const name="ribbonsSide_dtn">
          <notes>Transverse displacement from origin of a side's worth
              of ribbons on a negative side </notes>
          <uminus>
            <refer refTo="ribbonsSide_dt" />
          </uminus>
        </const>

        <!-- define a bunch of displacements for elements inside oneNoTKR
             in terms of their displacements in oneTower.  Everybody
             has to move up. -->
        <const name="gridFlangeNoTKR_dz" >
          <notes> adjust for placement in smaller envelop</notes>
          <minus>
            <refer refTo="gridFlange_dz" />
            <refer refTo="oneNoTKR_dz" />
          </minus>
        </const>

        <const name="gridWebNoTKR_dz" >
          <notes> adjust for placement in smaller envelop</notes>
          <minus>
            <refer refTo="gridWeb_dz" />
            <refer refTo="oneNoTKR_dz" />
          </minus>
        </const>

        <const name="CALNoTKR_dz" >
          <notes> adjust for placement in smaller envelop</notes>
          <minus>
            <refer refTo="CAL_dz" />
            <refer refTo="oneNoTKR_dz" />
          </minus>
        </const>

      </derCategory>

      <derCategory name="derNAD" save="true">
        <overview>Derived not-a-detector constants</overview>
        <const name="NADGridWebWidth" >
          <notes>Full width of grid web in X or Y</notes>
          <add>
            <mul>
              <const value="4" uType="count" />
              <refer refTo="NADGridWebCutout" />
            </mul>
            <mul>
              <const value="3" uType="count" />
              <refer refTo="NADGridWebInner" />
            </mul>
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridWebOuter" />
            </mul>
          </add>
        </const>

        <const name="NADGridFlangeWidth" >
          <notes>Full width of grid flange in X or Y</notes>
          <add>
            <refer refTo="NADGridWebWidth" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridFlangeOverhang" />
            </mul>
          </add>
        </const>

        <const name="NADGridFlangeOuter" >
          <notes>Width of outer piece of flange (wider than web)</notes>
          <quo>
            <minus>
              <refer refTo="NADGridFlangeWidth" />
              <add>
                <mul>
                  <const value="4" uType="count" />
                  <refer refTo="NADGridFlangeCutout" />
                </mul>
                <mul>
                  <const value="3" uType="count" />
                  <refer refTo="NADGridFlangeInner" />
                </mul>
              </add>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridFlangeInnerHalf">
          <notes> convenience</notes>
          <quo>
            <refer refTo="NADGridFlangeInner" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridWebInnerHalf">
          <notes> convenience</notes>
          <quo>
            <refer refTo="NADGridWebInner" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <!-- The per-tower web (flange) is picture-frame shaped.
             Break it into 4 boxes. Height of each is web (flange)
             height.  Width of each is NADGridWebInnerHalf
             (NADGridFlangeInnerHalf).  Two have length = towerPitch;
             the others are shorter by NADGridWebInner (NADGridFlangeInner)
        -->
        <const name="NADGridLenLong" >
            <notes>Length of longer outer (not per-tower) grid pieces</notes>
          <refer refTo="towerPitch" />
        </const>

        <const name="NADGridWebLenShort" >
          <notes>Length of shorter outer (not per-tower) 
     grid web pieces</notes>
          <minus> 
            <refer refTo="towerPitch" />
            <refer refTo="NADGridWebInner" />
          </minus>
        </const>

        <const name="NADGridFlangeLenShort" >
          <notes>Length of shorter outer (not per-tower) 
     grid flange pieces</notes>
          <minus> 
            <refer refTo="towerPitch" />
            <refer refTo="NADGridFlangeInner" />
          </minus>
        </const>

<!-- Define some constants for the outside "picture frames" for
     grid web and grid flange -->
        <const name="NADGridWebOutsideWidth" >
          <notes>Width of web outside towers (i.e., 4 * towerPitch)</notes>
          <quo>
            <minus>
              <refer refTo="NADGridWebWidth" />
              <mul>
                <const value="4" uType="count" />
                <refer refTo="towerPitch" />
              </mul>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridFlangeOutsideWidth" >
          <notes>Width of flange outside towers (i.e., 4 * towerPitch)</notes>
          <quo>
            <minus>
              <refer refTo="NADGridFlangeWidth" />
              <mul>
                <const value="4" uType="count" />
                <refer refTo="towerPitch" />
              </mul>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridWebOutsideLenShort" >
          <notes>Length of short outside piece of grid web</notes>
          <minus>
            <refer refTo="NADGridWebWidth" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridWebOutsideWidth" />
            </mul>
          </minus>
        </const>

        <const name = "NADGridFlange_dz" >
          <notes>Displacement of flange w.r.t. Ritz origin, which is
                 at its top face</notes>
          <uminus>
            <quo>
              <refer refTo="NADGridFlangeZ" />
              <const value="2" uType="count" />
            </quo>
          </uminus>
        </const>

        <const name = "NADGridWeb_dz" >          
          <notes>Displacement of grid  w.r.t. Ritz origin. Web is
                 immediately below flange.</notes>
          <uminus>
            <add>
               <refer refTo="NADGridFlangeZ" />
               <quo>
                 <refer refTo="NADGridWebZ" />
                 <const value="2" uType="count" />
               </quo>
             </add>
          </uminus>
        </const>
           

        <const name="NADGridFlangeOutsideLenShort" >
          <notes>Length of short outside piece of grid web</notes>
          <minus>
            <refer refTo="NADGridFlangeWidth" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridFlangeOutsideWidth" />
            </mul>
          </minus>
        </const>
        <const name="NADBlanketTopHoleTrans">
          <notes>Transverse distance between inner edges of crown
              May, 2006.</notes>
          <minus>
            <refer refTo="NADBlanketTopTrans" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADCrownWidth" />
            </mul>
          </minus>
        </const>

        <const name="NADBlanketTopInteriorTrans">
          <notes>Transverse dimension of depressed part of top blanket,
                May, 2006</notes>
          <add>
            <refer refTo="NADBlanketTopHoleTrans" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADBlanketTopThick" />
            </mul>
          </add>
        </const>
  
        <const name="NADBlanketTopMidZ" >
          <notes>Z of middle of three stacked volumes comprising blanket
                 top.  </notes>
          <minus>
            <refer refTo="NADCrownDepth" />
            <refer refTo="NADBlanketTopThick" />
          </minus>
        </const>

        <const name="NADBlanketSideY_l" >
          <notes>length in long (x) dimension of Y-sides of blanket</notes>
          <refer refTo="NADBlanketTopTrans" />
        </const>

        <const name="NADBlanketSideX_l" >
          <notes>length in long (Y) dimension of X-sides of blanket, shorter
            than Y-sides because Y-sides cover corners</notes>
          <minus>
            <refer refTo="NADBlanketTopTrans" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADBlanketSideThick" />
            </mul>
          </minus>
        </const>

        <const name="NADBlanketSide_dt" >
          <notes>Transverse + displacement of blanket side</notes>
          <half>
            <minus>
              <refer refTo="NADBlanketTopTrans" />
              <refer refTo="NADBlanketSideThick" />
            </minus>
          </half>
        </const>



        <const name="NADBlanketSide_dtn">
          <notes>x (resp. y) displacement of neg. x (resp.y)
               side of blanket</notes>
          <uminus>
            <refer refTo = "NADBlanketSide_dt" />
          </uminus>
        </const>

        <const name="NADBlanketTopInterior_dz">
          <notes>Z-displacement of blanket interior to crown</notes>
          <add>
            <refer refTo="topTileEdge_dz" />
            <refer refTo="NADBlanketToTopTile" />
            <half>
              <add>
                <refer refTo="tileThickness" />
                <refer refTo="NADBlanketTopThick" />
              </add>
            </half>
          </add>
        </const>

        <const name="NADBlanketTopMid_dz" >
          <notes>Z-displacement of middle section of blanket, above
             interior, below outer crown piece</notes>
          <add>
            <refer refTo="NADBlanketTopInterior_dz" />
            <half>
              <add>
                <refer refTo="NADBlanketTopThick" />
                <refer refTo="NADBlanketTopMidZ" />
              </add>
            </half>
          </add>
        </const>

        <const name="NADBlanketTopTop_dz" >
          <notes>Z-displacement of top crown sectio of blanket</notes>
          <add>
            <refer refTo="NADBlanketTopMid_dz" />
            <half>
              <add>
                <refer refTo="NADBlanketTopThick" />
                <refer refTo="NADBlanketTopMidZ" />
              </add>
            </half>
          </add>
        </const>

        <const name="NADBlanketSides_dz">
          <notes>z displacement of sides of blanket.  Sits
                  just under blanket crown piece.</notes>
            <minus>
              <refer refTo="NADBlanketTopTop_dz" />
              <half>
                <add>
                  <refer refTo="NADBlanketSideZ" />
                  <refer refTo="NADBlanketTopThick" />
                </add>
              </half>
            </minus>
          </const>

          <const name="NADBlanketSideToSideTileComp" >
            <notes>Compute distance from inner edge of side blanket
                   to outer edge of side tile (top row)</notes>
            <minus>
              <refer refTo="NADBlanketSide_dt" />
              <add>
                <refer refTo="sideTileR0_dt" />
                <half>
                  <add>
                    <refer refTo="tileThickness" />
                    <refer refTo="NADBlanketSideThick" />
                  </add>
                </half>
              </add>
            </minus>
          </const>

          <const name="NAD_siu_epu_dxn">
            <notes>Some SIUs and EPUs have neg. x displacement</notes>
            <uminus>
              <refer refTo="NAD_siu_epu_dx" />
            </uminus>
          </const>

          <const name="NADepu_dyn">
            <notes>Some EPUs have neg. y displacement</notes>
            <uminus>
              <refer refTo="NADepu_dy" />
            </uminus>
          </const>

          <const name="NADtem_small_dtn">
            <notes>TEMs form 4x4 array</notes>
            <uminus>
              <refer refTo="NADtem_small_dt" />
            </uminus>
          </const>

          <const name="NADtem_large_dtn">
            <notes>TEMs form 4x4 array</notes>
            <uminus>
              <refer refTo="NADtem_large_dt" />
            </uminus>
          </const>

          <const name="NADsiu_dy">
            <notes>Same as small TEM transverse displacement</notes>
            <refer refTo="NADtem_small_dt" />
          </const>

          <const name="NADsiu_dyn">
            <notes>Same as small TEM transverse displacement</notes>
            <uminus>
              <refer refTo="NADsiu_dy" />
            </uminus>
          </const>

          <const name="NADhib_small_dt">
            <notes>HIBs have same transverse offsets as TEMs, (but there
                  are only 5 of them so not all combinations occur)
            </notes>
            <refer refTo="NADtem_small_dt" />
          </const>

          <const name="NADhib_small_dtn">
            <notes>HIBs have same transverse offsets as TEMs, (but there
                  are only 5 of them so not all combinations occur)
            </notes>
            <refer refTo="NADtem_small_dtn" />
          </const>

          <const name="NADhib_large_dt">
            <notes>HIBs have same transverse offsets as TEMs, (but there
                  are only 5 of them so not all combinations occur)
            </notes>
            <refer refTo="NADtem_large_dt" />
          </const>

          <const name="NADhib_large_dtn">
            <notes>HIBs have same transverse offsets as TEMs, (but there
                  are only 5 of them so not all combinations occur)
            </notes>
            <refer refTo="NADtem_large_dtn" />
          </const>

          <const name="NADelectAlDoubleThick">
            <notes>Convenience value</notes>
            <add>
              <refer refTo="NADelectAlThick" />
              <refer refTo="NADelectAlThick" />
            </add>
          </const>

          <const name="NADtemIntr_t">
            <notes>transverse dimension of TEM interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADtem_t" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADtemIntr_z">
            <notes>z-dimension of TEM interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADtem_z" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>



          <const name="NADgasuIntr_x">
            <notes>x-dimension of GASU interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADgasu_x" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADgasuIntr_y">
            <notes>y-dimension of GASU interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADgasu_y" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADgasuIntr_z">
            <notes>z-dimension of GASU interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADgasu_z" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADpduIntr_x">
            <notes>x-dimension of PDU interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADpdu_x" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADpduIntr_y">
            <notes>y-dimension of PDU interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADpdu_y" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADpduIntr_z">
            <notes>z-dimension of PDU interior, excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADpdu_z" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADelectCommonIntr_t">
            <notes>transverse dimension of SIU, EPU, HIB interior, 
                   excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADelectCommon_t" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

          <const name="NADelectCommonIntr_z">
            <notes>Z dimension of SIU, EPU, HIB interior, 
                   excluding Al shell
            </notes>
            <minus>
              <refer refTo="NADelectCommon_z" />
              <refer refTo="NADelectAlDoubleThick" />
            </minus>
          </const>

<!-- Starting here, ending with TEMintrDensity, go through
     similar rigamarole for GASU, PDU, SIU/EPU and HIB
 -->
          <const name="TEMvol">
            <notes>Volume of TEM, including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADtem_t" />
               <refer refTo="NADtem_t" />
               <refer refTo="NADtem_z" />
            </mul>
          </const>

          <const name="TEMintrVol">
            <notes>Volume of TEM, not including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADtemIntr_t" />
               <refer refTo="NADtemIntr_t" />
               <refer refTo="NADtemIntr_z" />
            </mul>
          </const>

          <const name="TEMAlMass">
            <notes>Calc. from TEM dimensions, assuming Al box of
              one-tenth inch thickness. Result is in grams. </notes>
            <mul>
              <minus>
                <refer refTo="TEMvol" />
                <refer refTo="TEMintrVol" />
              </minus>
              <refer refTo="cubicmmToCubiccm" />
              <refer refTo="NADelectAlDensity" />
            </mul>
          </const>

          <const name="TEMintrDensity">
            <notes>Computed from TEM dimensions and total mass,
               assuming Al shell of 2.54 mm all around</notes>
            <quo>
              <minus>
                <refer refTo="TEMmass" />
                <refer refTo="TEMAlMass" />
              </minus>
              <mul>
                <refer refTo="TEMintrVol" />
                <refer refTo="cubicmmToCubiccm" />
              </mul>
            </quo>
          </const>

<!-- start GASU -->
          <const name="GASUvol">
            <notes>Volume of GASU, including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADgasu_x" />
               <refer refTo="NADgasu_y" />
               <refer refTo="NADgasu_z" />
            </mul>
          </const>

          <const name="GASUintrVol">
            <notes>Volume of GASU, not including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADgasuIntr_x" />
               <refer refTo="NADgasuIntr_y" />
               <refer refTo="NADgasuIntr_z" />
            </mul>
          </const>

          <const name="GASUAlMass">
            <notes>Calc. from GASU dimensions, assuming Al box of
              one-tenth inch thickness. Result is in grams. </notes>
            <mul>
              <minus>
                <refer refTo="GASUvol" />
                <refer refTo="GASUintrVol" />
              </minus>
              <refer refTo="cubicmmToCubiccm" />
              <refer refTo="NADelectAlDensity" />
            </mul>
          </const>

          <const name="GASUintrDensity">
            <notes>Computed from GASU dimensions and total mass,
               assuming Al shell of 2.54 mm all around</notes>
            <quo>
              <minus>
                <refer refTo="GASUmass" />
                <refer refTo="GASUAlMass" />
              </minus>
              <mul>
                <refer refTo="GASUintrVol" />
                <refer refTo="cubicmmToCubiccm" />
              </mul>
            </quo>
          </const>

<!-- begin PDU -->
          <const name="PDUvol">
            <notes>Volume of PDU, including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADpdu_x" />
               <refer refTo="NADpdu_y" />
               <refer refTo="NADpdu_z" />
            </mul>
          </const>

          <const name="PDUintrVol">
            <notes>Volume of PDU, not including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADpduIntr_x" />
               <refer refTo="NADpduIntr_y" />
               <refer refTo="NADpduIntr_z" />
            </mul>
          </const>

          <const name="PDUAlMass">
            <notes>Calc. from PDU dimensions, assuming Al box of
              one-tenth inch thickness. Result is in grams. </notes>
            <mul>
              <minus>
                <refer refTo="PDUvol" />
                <refer refTo="PDUintrVol" />
              </minus>
              <refer refTo="cubicmmToCubiccm" />
              <refer refTo="NADelectAlDensity" />
            </mul>
          </const>

          <const name="PDUintrDensity">
            <notes>Computed from PDU dimensions and total mass,
               assuming Al shell of 2.54 mm all around</notes>
            <quo>
              <minus>
                <refer refTo="PDUmass" />
                <refer refTo="PDUAlMass" />
              </minus>
              <mul>
                <refer refTo="PDUintrVol" />
                <refer refTo="cubicmmToCubiccm" />
              </mul>
            </quo>
          </const>

<!-- begin SIU (= EPU for this purpose and = HIB for volume only -->
          <const name="NADelectCommonVol">
            <notes>Volume of SIU, EPU HIB, including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADelectCommon_t" />
               <refer refTo="NADelectCommon_t" />
               <refer refTo="NADelectCommon_z" />
            </mul>
          </const>

          <const name="NADelectCommonIntrVol">
            <notes>Volume of TEM, not including Al shell, in mm**3</notes>
            <mul>
               <refer refTo="NADelectCommonIntr_t" />
               <refer refTo="NADelectCommonIntr_t" />
               <refer refTo="NADelectCommonIntr_z" />
            </mul>
          </const>

          <const name="NADelectCommonAlMass">
            <notes>Calc. from SIU/EPU,HIB dimensions, assuming Al box of
              one-tenth inch thickness. Result is in grams. </notes>
            <mul>
              <minus>
                <refer refTo="NADelectCommonVol" />
                <refer refTo="NADelectCommonIntrVol" />
              </minus>
              <refer refTo="cubicmmToCubiccm" />
              <refer refTo="NADelectAlDensity" />
            </mul>
          </const>

          <const name="SIUintrDensity">
            <notes>Computed from  dimensions and total mass,
               assuming Al shell of 2.54 mm all around</notes>
            <quo>
              <minus>
                <refer refTo="SIU_EPUmass" />
                <refer refTo="NADelectCommonAlMass" />
              </minus>
              <mul>
                <refer refTo="NADelectCommonIntrVol" />
                <refer refTo="cubicmmToCubiccm" />
              </mul>
            </quo>
          </const>

<!-- Just need to redo last definition for HIB -->
          <const name="HIBintrDensity">
            <notes>Computed from  dimensions and total mass,
               assuming Al shell of 2.54 mm all around</notes>
            <quo>
              <minus>
                <refer refTo="HIBmass" />
                <refer refTo="NADelectCommonAlMass" />
              </minus>
              <mul>
                <refer refTo="NADelectCommonIntrVol" />
                <refer refTo="cubicmmToCubiccm" />
              </mul>
            </quo>
          </const>
              
      </derCategory>
   </derived>











