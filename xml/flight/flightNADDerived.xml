<!-- move NAD derived stuff here -->

<derCategory name="derNAD" save="true" >
  <overview>Derived constants for LAT volumes not closely associated
            with one of the main detector subsystems
            (Not A Detector)
  </overview>

        <const name="gridFlange_dz">
          <notes>Z-Offset of grid flange pieces within single-tower volume.
          </notes>
          <minus>
            <refer refTo="towersTotalHalfZ" /> <!-- start at top -->
            <add>
              <refer refTo="TKRVertStayClear" />
              <quo>
                <refer refTo="NADGridFlangeZ" />
                <const value="2" uType="count" />
              </quo>
            </add>
          </minus>
        </const>

        <const name="gridWeb_dz" >
          <notes>Z-Offset of grid web pieces within single-tower volume</notes>
          <minus>
            <refer refTo="gridFlange_dz" />
            <quo>
              <add>
                <refer refTo="NADGridFlangeZ" />
                <refer refTo="NADGridWebZ" />
              </add>
              <const value="2" uType="count" />
            </quo>
          </minus>
        </const>

        <const name="gridFlange_dt" >
          <notes>Transverse offset of per-tower grid flange pieces</notes>
          <quo>
            <minus>
              <refer refTo="towerPitch" />
              <refer refTo="NADGridFlangeInnerHalf"/>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="gridFlange_dtn" >
          <notes>Negative transverse offset of per-tower grid flange 
                 pieces</notes>
          <uminus>
            <refer refTo="gridFlange_dt" />
          </uminus>
        </const>

        <const name="gridWeb_dt" >
          <notes>Transverse offset of per-tower grid web pieces</notes>
          <quo>
            <minus>
              <refer refTo="towerPitch" />
              <refer refTo="NADGridWebInnerHalf"/>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>
        
        <const name="gridWeb_dtn" >
          <notes>Negative transverse offset of per-tower grid web pieces
          </notes>
          <uminus>
            <refer refTo="gridWeb_dt" />
          </uminus>
        </const>
        
        <const name="LATGridFlange_dt" >
          <notes>Transverse offset of LAT-wide grid flange pieces</notes>
          <quo>
            <minus>
              <refer refTo="NADGridFlangeWidth" />
              <refer refTo="NADGridFlangeOutsideWidth" />
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>
        
        <const name="LATGridFlange_dtn" >
          <notes>Neg. transverse offset of LAT-wide grid flange pieces</notes>
          <uminus>
            <refer refTo="LATGridFlange_dt" />
          </uminus>
        </const>
        
        <const name="LATGridWeb_dt" >
          <notes>Transverse offset of LAT-wide grid web pieces</notes>
          <quo>
            <minus>
              <refer refTo="NADGridWebWidth" />
              <refer refTo="NADGridWebOutsideWidth" />
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>
        
        <const name="LATGridWeb_dtn" >
          <notes>Neg. transverse offset of LAT-wide grid web pieces</notes>
          <uminus>
            <refer refTo="LATGridWeb_dt" />
          </uminus>
        </const>


        <const name="NADGridWebWidth" >
          <notes>Full width of grid web in X or Y</notes>
          <add>
            <mul>
              <const value="4" uType="count" />
              <refer refTo="NADGridWebCutout" />
            </mul>
            <mul>
              <const value="3" uType="count" />
              <refer refTo="NADGridWebInner" />
            </mul>
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridWebOuter" />
            </mul>
          </add>
        </const>

        <const name="NADGridFlangeWidth" >
          <notes>Full width of grid flange in X or Y</notes>
          <add>
            <refer refTo="NADGridWebWidth" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridFlangeOverhang" />
            </mul>
          </add>
        </const>

        <const name="NADGridFlangeOuter" >
          <notes>Width of outer piece of flange (wider than web)</notes>
          <quo>
            <minus>
              <refer refTo="NADGridFlangeWidth" />
              <add>
                <mul>
                  <const value="4" uType="count" />
                  <refer refTo="NADGridFlangeCutout" />
                </mul>
                <mul>
                  <const value="3" uType="count" />
                  <refer refTo="NADGridFlangeInner" />
                </mul>
              </add>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridFlangeInnerHalf">
          <notes> convenience</notes>
          <quo>
            <refer refTo="NADGridFlangeInner" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridWebInnerHalf">
          <notes> convenience</notes>
          <quo>
            <refer refTo="NADGridWebInner" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <!-- The per-tower web (flange) is picture-frame shaped.
             Break it into 4 boxes. Height of each is web (flange)
             height.  Width of each is NADGridWebInnerHalf
             (NADGridFlangeInnerHalf).  Two have length = towerPitch;
             the others are shorter by NADGridWebInner (NADGridFlangeInner)
        -->
        <const name="NADGridLenLong" >
            <notes>Length of longer outer (not per-tower) grid pieces</notes>
          <refer refTo="towerPitch" />
        </const>

        <const name="NADGridWebLenShort" >
          <notes>Length of shorter outer (not per-tower) 
     grid web pieces</notes>
          <minus> 
            <refer refTo="towerPitch" />
            <refer refTo="NADGridWebInner" />
          </minus>
        </const>

        <const name="NADGridFlangeLenShort" >
          <notes>Length of shorter outer (not per-tower) 
     grid flange pieces</notes>
          <minus> 
            <refer refTo="towerPitch" />
            <refer refTo="NADGridFlangeInner" />
          </minus>
        </const>

<!-- Define some constants for the outside "picture frames" for
     grid web and grid flange -->
        <const name="NADGridWebOutsideWidth" >
          <notes>Width of web outside towers (i.e., 4 * towerPitch)</notes>
          <quo>
            <minus>
              <refer refTo="NADGridWebWidth" />
              <mul>
                <const value="4" uType="count" />
                <refer refTo="towerPitch" />
              </mul>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridFlangeOutsideWidth" >
          <notes>Width of flange outside towers (i.e., 4 * towerPitch)</notes>
          <quo>
            <minus>
              <refer refTo="NADGridFlangeWidth" />
              <mul>
                <const value="4" uType="count" />
                <refer refTo="towerPitch" />
              </mul>
            </minus>
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="NADGridWebOutsideLenShort" >
          <notes>Length of short outside piece of grid web</notes>
          <minus>
            <refer refTo="NADGridWebWidth" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridWebOutsideWidth" />
            </mul>
          </minus>
        </const>

        <const name = "NADGridFlange_dz" >
          <notes>Displacement of flange w.r.t. Ritz origin, which is
                 at its top face</notes>
          <uminus>
            <quo>
              <refer refTo="NADGridFlangeZ" />
              <const value="2" uType="count" />
            </quo>
          </uminus>
        </const>

        <const name = "NADGridWeb_dz" >          
          <notes>Displacement of grid  w.r.t. Ritz origin. Web is
                 immediately below flange.</notes>
          <uminus>
            <add>
               <refer refTo="NADGridFlangeZ" />
               <quo>
                 <refer refTo="NADGridWebZ" />
                 <const value="2" uType="count" />
               </quo>
             </add>
          </uminus>
        </const>
           

        <const name="NADGridFlangeOutsideLenShort" >
          <notes>Length of short outside piece of grid web</notes>
          <minus>
            <refer refTo="NADGridFlangeWidth" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADGridFlangeOutsideWidth" />
            </mul>
          </minus>
        </const>
        <const name="NADBlanketTopHoleTrans">
          <notes>Transverse distance between inner edges of crown
              May, 2006.</notes>
          <minus>
            <refer refTo="NADBlanketTopTrans" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADCrownWidth" />
            </mul>
          </minus>
        </const>

        <const name="NADBlanketTopInteriorTrans">
          <notes>Transverse dimension of depressed part of top blanket,
                May, 2006</notes>
          <add>
            <refer refTo="NADBlanketTopHoleTrans" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADBlanketTopThick" />
            </mul>
          </add>
        </const>
  
        <const name="NADBlanketTopMidZ" >
          <notes>Z of middle of three stacked volumes comprising blanket
                 top.  </notes>
          <minus>
            <refer refTo="NADCrownDepth" />
            <refer refTo="NADBlanketTopThick" />
          </minus>
        </const>

        <const name="NADBlanketSideY_l" >
          <notes>length in long (x) dimension of Y-sides of blanket</notes>
          <refer refTo="NADBlanketTopTrans" />
        </const>

        <const name="NADBlanketSideX_l" >
          <notes>length in long (Y) dimension of X-sides of blanket, shorter
            than Y-sides because Y-sides cover corners</notes>
          <minus>
            <refer refTo="NADBlanketTopTrans" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="NADBlanketSideThick" />
            </mul>
          </minus>
        </const>

        <const name="NADBlanketSide_dt" >
          <notes>Transverse + displacement of blanket side</notes>
          <half>
            <minus>
              <refer refTo="NADBlanketTopTrans" />
              <refer refTo="NADBlanketSideThick" />
            </minus>
          </half>
        </const>



        <const name="NADBlanketSide_dtn">
          <notes>x (resp. y) displacement of neg. x (resp.y)
               side of blanket</notes>
          <uminus>
            <refer refTo = "NADBlanketSide_dt" />
          </uminus>
        </const>

        <const name="NADBlanketTopInterior_dz">
          <notes>Z-displacement of blanket interior to crown</notes>
          <add>
            <refer refTo="topTileEdge_dz" />
            <refer refTo="NADBlanketToTopTile" />
            <half>
              <add>
                <refer refTo="tileThickness" />
                <refer refTo="NADBlanketTopThick" />
              </add>
            </half>
          </add>
        </const>

        <const name="NADBlanketTopMid_dz" >
          <notes>Z-displacement of middle section of blanket, above
             interior, below outer crown piece</notes>
          <add>
            <refer refTo="NADBlanketTopInterior_dz" />
            <half>
              <add>
                <refer refTo="NADBlanketTopThick" />
                <refer refTo="NADBlanketTopMidZ" />
              </add>
            </half>
          </add>
        </const>

        <const name="NADBlanketTopTop_dz" >
          <notes>Z-displacement of top crown sectio of blanket</notes>
          <add>
            <refer refTo="NADBlanketTopMid_dz" />
            <half>
              <add>
                <refer refTo="NADBlanketTopThick" />
                <refer refTo="NADBlanketTopMidZ" />
              </add>
            </half>
          </add>
        </const>

        <const name="NADBlanketSides_dz">
          <notes>z displacement of sides of blanket.  Sits
                  just under blanket crown piece.</notes>
            <minus>
              <refer refTo="NADBlanketTopTop_dz" />
              <half>
                <add>
                  <refer refTo="NADBlanketSideZ" />
                  <refer refTo="NADBlanketTopThick" />
                </add>
              </half>
            </minus>
          </const>

          <const name="NADBlanketSideToSideTileComp" >
            <notes>Compute distance from inner edge of side blanket
                   to outer edge of side tile (top row)</notes>
            <minus>
              <refer refTo="NADBlanketSide_dt" />
              <add>
                <refer refTo="tileSideR0_dt" />
                <half>
                  <add>
                    <refer refTo="tileThickness" />
                    <refer refTo="NADBlanketSideThick" />
                  </add>
                </half>
              </add>
            </minus>
          </const>

      </derCategory>

<derCategory name="derLATelect" save="true" >
  <overview>Derived constants for LAT electronics and associated
           volumes, such as cabling
  </overview>

  <const name="NAD_siu_epu_dxn">
    <notes>Some SIUs and EPUs have neg. x displacement</notes>
    <uminus>
      <refer refTo="NAD_siu_epu_dx" />
    </uminus>
  </const>

  <const name="NADepu_dyn">
    <notes>Some EPUs have neg. y displacement</notes>
    <uminus>
      <refer refTo="NADepu_dy" />
    </uminus>
  </const>

  <const name="NADtem_small_dtn">
    <notes>TEMs form 4x4 array</notes>
    <uminus>
      <refer refTo="NADtem_small_dt" />
    </uminus>
  </const>

  <const name="NADtem_large_dtn">
    <notes>TEMs form 4x4 array</notes>
    <uminus>
      <refer refTo="NADtem_large_dt" />
    </uminus>
  </const>

  <const name="NADsiu_dy">
    <notes>Same as small TEM transverse displacement</notes>
    <refer refTo="NADtem_small_dt" />
  </const>

  <const name="NADsiu_dyn">
    <notes>Same as small TEM transverse displacement</notes>
    <uminus>
      <refer refTo="NADsiu_dy" />
    </uminus>
  </const>

  <const name="NADhib_small_dt">
    <notes>HIBs have same transverse offsets as TEMs, (but there
          are only 5 of them so not all combinations occur)
    </notes>
    <refer refTo="NADtem_small_dt" />
  </const>

  <const name="NADhib_small_dtn">
    <notes>HIBs have same transverse offsets as TEMs, (but there
          are only 5 of them so not all combinations occur)
    </notes>
    <refer refTo="NADtem_small_dtn" />
  </const>

  <const name="NADhib_large_dt">
    <notes>HIBs have same transverse offsets as TEMs, (but there
          are only 5 of them so not all combinations occur)
    </notes>
    <refer refTo="NADtem_large_dt" />
  </const>

  <const name="NADhib_large_dtn">
    <notes>HIBs have same transverse offsets as TEMs, (but there
          are only 5 of them so not all combinations occur)
    </notes>
    <refer refTo="NADtem_large_dtn" />
  </const>

  <const name="NADelectAlDoubleThick">
    <notes>Convenience value</notes>
    <add>
      <refer refTo="NADelectAlThick" />
      <refer refTo="NADelectAlThick" />
    </add>
  </const>

  <const name="NADtemIntr_t">
    <notes>transverse dimension of TEM interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADtem_t" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="NADtemIntr_z">
    <notes>z-dimension of TEM interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADtem_z" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>



  <const name="NADgasuIntr_x">
    <notes>x-dimension of GASU interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADgasu_x" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="NADgasuIntr_y">
    <notes>y-dimension of GASU interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADgasu_y" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="NADgasuIntr_z">
    <notes>z-dimension of GASU interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADgasu_z" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="NADpduIntr_x">
    <notes>x-dimension of PDU interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADpdu_x" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="NADpduIntr_y">
    <notes>y-dimension of PDU interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADpdu_y" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="NADpduIntr_z">
    <notes>z-dimension of PDU interior, excluding Al shell
    </notes>
    <minus>
      <refer refTo="NADpdu_z" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="LATelectCommonIntr_t">
    <notes>transverse dimension of SIU, EPU, HIB interior, 
           excluding Al shell
    </notes>
    <minus>
      <refer refTo="LATelectCommon_t" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

  <const name="LATelectCommonIntr_z">
    <notes>Z dimension of SIU, EPU, HIB interior, 
           excluding Al shell
    </notes>
    <minus>
      <refer refTo="LATelectCommon_z" />
      <refer refTo="NADelectAlDoubleThick" />
    </minus>
  </const>

<!-- Starting here, ending with TEMintrDensity, go through
     similar rigamarole for GASU, PDU, SIU/EPU and HIB
 -->
  <const name="TEMvol">
    <notes>Volume of TEM, including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="NADtem_t" />
       <refer refTo="NADtem_t" />
       <refer refTo="NADtem_z" />
    </mul>
  </const>

  <const name="TEMintrVol">
    <notes>Volume of TEM, not including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="NADtemIntr_t" />
       <refer refTo="NADtemIntr_t" />
       <refer refTo="NADtemIntr_z" />
    </mul>
  </const>

  <const name="TEMAlMass">
    <notes>Calc. from TEM dimensions, assuming Al box of
      one-tenth inch thickness. Result is in grams. </notes>
    <mul>
      <minus>
        <refer refTo="TEMvol" />
        <refer refTo="TEMintrVol" />
      </minus>
      <refer refTo="cubicmmToCubiccm" />
      <refer refTo="NADelectAlDensity" />
    </mul>
  </const>

  <const name="TEMintrDensity">
    <notes>Computed from TEM dimensions and total mass,
       assuming Al shell of 2.54 mm all around</notes>
    <quo>
      <minus>
        <refer refTo="TEMmass" />
        <refer refTo="TEMAlMass" />
      </minus>
      <mul>
        <refer refTo="TEMintrVol" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>

<!-- start GASU -->
  <const name="GASUvol">
    <notes>Volume of GASU, including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="NADgasu_x" />
       <refer refTo="NADgasu_y" />
       <refer refTo="NADgasu_z" />
    </mul>
  </const>

  <const name="GASUintrVol">
    <notes>Volume of GASU, not including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="NADgasuIntr_x" />
       <refer refTo="NADgasuIntr_y" />
       <refer refTo="NADgasuIntr_z" />
    </mul>
  </const>

  <const name="GASUAlMass">
    <notes>Calc. from GASU dimensions, assuming Al box of
      one-tenth inch thickness. Result is in grams. </notes>
    <mul>
      <minus>
        <refer refTo="GASUvol" />
        <refer refTo="GASUintrVol" />
      </minus>
      <refer refTo="cubicmmToCubiccm" />
      <refer refTo="NADelectAlDensity" />
    </mul>
  </const>

  <const name="GASUintrDensity">
    <notes>Computed from GASU dimensions and total mass,
       assuming Al shell of 2.54 mm all around</notes>
    <quo>
      <minus>
        <refer refTo="GASUmass" />
        <refer refTo="GASUAlMass" />
      </minus>
      <mul>
        <refer refTo="GASUintrVol" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>

<!-- begin PDU -->
  <const name="PDUvol">
    <notes>Volume of PDU, including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="NADpdu_x" />
       <refer refTo="NADpdu_y" />
       <refer refTo="NADpdu_z" />
    </mul>
  </const>

  <const name="PDUintrVol">
    <notes>Volume of PDU, not including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="NADpduIntr_x" />
       <refer refTo="NADpduIntr_y" />
       <refer refTo="NADpduIntr_z" />
    </mul>
  </const>

  <const name="PDUAlMass">
    <notes>Calc. from PDU dimensions, assuming Al box of
      one-tenth inch thickness. Result is in grams. </notes>
    <mul>
      <minus>
        <refer refTo="PDUvol" />
        <refer refTo="PDUintrVol" />
      </minus>
      <refer refTo="cubicmmToCubiccm" />
      <refer refTo="NADelectAlDensity" />
    </mul>
  </const>

  <const name="PDUintrDensity">
    <notes>Computed from PDU dimensions and total mass,
       assuming Al shell of 2.54 mm all around</notes>
    <quo>
      <minus>
        <refer refTo="PDUmass" />
        <refer refTo="PDUAlMass" />
      </minus>
      <mul>
        <refer refTo="PDUintrVol" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>

<!-- begin SIU (= EPU for this purpose and = HIB for volume only -->
  <const name="LATcommonElectCount" value="10" uType="count" >
    <notes>5 HIB + 3 EPU + 2 SIU</notes>
  </const>

  <const name="LATelectCommonVol">
    <notes>Volume of SIU, EPU HIB, including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="LATelectCommon_t" />
       <refer refTo="LATelectCommon_t" />
       <refer refTo="LATelectCommon_z" />
    </mul>
  </const>

  <const name="LATelectCommonIntrVol">
    <notes>Volume of TEM, not including Al shell, in mm**3</notes>
    <mul>
       <refer refTo="LATelectCommonIntr_t" />
       <refer refTo="LATelectCommonIntr_t" />
       <refer refTo="LATelectCommonIntr_z" />
    </mul>
  </const>

  <const name="LATelectCommonAlMass">
    <notes>Calc. from SIU/EPU,HIB dimensions, assuming Al box of
      one-tenth inch thickness. Result is in grams. </notes>
    <mul>
      <minus>
        <refer refTo="LATelectCommonVol" />
        <refer refTo="LATelectCommonIntrVol" />
      </minus>
      <refer refTo="cubicmmToCubiccm" />
      <refer refTo="NADelectAlDensity" />
    </mul>
  </const>

  <const name="SIUintrDensity">
    <notes>Computed from  dimensions and total mass,
       assuming Al shell of 2.54 mm all around</notes>
    <quo>
      <minus>
        <refer refTo="SIU_EPUmass" />
        <refer refTo="LATelectCommonAlMass" />
      </minus>
      <mul>
        <refer refTo="LATelectCommonIntrVol" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>

<!-- Just need to redo last definition for HIB -->
  <const name="HIBintrDensity">
    <notes>Computed from  dimensions and total mass,
       assuming Al shell of 2.54 mm all around</notes>
    <quo>
      <minus>
        <refer refTo="HIBmass" />
        <refer refTo="LATelectCommonAlMass" />
      </minus>
      <mul>
        <refer refTo="LATelectCommonIntrVol" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>

  <const name="LATelectEnv_z">
    <notes>Z-dimension of a box just big enough to contain
           TEMs, GASU, etc.</notes>
    <add>
      <minus>
        <refer refTo="NADtem_dz" />
        <refer refTo="NAD_LAT_L2Electronics_dz" />
      </minus>
      <half>
        <add>
          <refer refTo="NADtem_z" />
          <refer refTo="LATelectCommon_z" />
        </add>
      </half>
    </add>
  </const>

  <const name="LATelectEnv_dz">
    <notes>Z-displacement of envelope
    containing LAT electronics</notes>
    <add>
      <refer refTo="NADtem_dz" />
      <half>
        <refer refTo="NADtem_z" />
      </half>
      <half>
        <uminus>
          <refer refTo="LATelectEnv_z" />
        </uminus>
      </half>
    </add>
  </const>

  <const name="XLAT_dz">
<notes>Z displacement of XLAT-plate needs to be a little lower than 
official value from LAT-TD-00564-12, -477.186, to avoid collision with
electronics.</notes>
  <minus>
    <refer refTo="NAD_LAT_L2Electronics_dz" />
    <half>
      <add>
        <refer refTo="LATelectCommon_z" />
        <refer refTo="XLAT_z" />
      </add>
    </half>
  </minus>
</const>


  <const name="TEMrel_dz"> 
    <notes>Displacement of TEMs relative to electronics envelope</notes>
    <minus>
      <refer refTo="NADtem_dz" />
      <refer refTo="LATelectEnv_dz" />
    </minus>
  </const>

  <const name="L2ElectronicsRel_dz" >
    <notes>Displacement of GASU, PDU, etc. relative to electronics 
           envelope</notes>
    <minus>
      <refer refTo="NAD_LAT_L2Electronics_dz" />
      <refer refTo="LATelectEnv_dz" />
    </minus>
  </const>

  <const name="LATelectInnerCable_t" >
    <notes>Transverse dimension of a box within
       LAT elect envelope containing approx. half
       the mass of Cu cables.  Assume it goes out
       to inner boundaries of outer HIBs.</notes>
    <minus>
      <add>
        <refer refTo="NADhib_large_dt" />
        <refer refTo="NADhib_large_dt" />
      </add>
      <refer refTo="LATelectCommon_t" />
    </minus>
  </const>       

  <const name="LATelectInnerCableEnvVol" uType="none" >      
    <notes>Volume of inner box, densely filled with cable</notes>
    <mul>
      <refer refTo="LATelectInnerCable_t" />
      <refer refTo="LATelectInnerCable_t" />
      <refer refTo="LATelectEnv_z" />
    </mul>
  </const>

  <const name="LATelectEnvVol" uType="none" >      
    <notes>Volume entire electronics envelope</notes>
    <mul>
      <refer refTo="LATelectEnv_t" />
      <refer refTo="LATelectEnv_t" />
      <refer refTo="LATelectEnv_z" />
    </mul>
  </const>

  <const name="LATelectVol" uType="none" >
    <notes>Total volume of TEMs + GASU + PDU + etc.</notes>
    <add>
      <mul>
        <const value="16" uType="count" />
        <refer refTo="TEMvol" />
      </mul>
      <refer refTo="GASUvol" />      
      <refer refTo="PDUvol" />    
      <mul>
        <refer refTo="LATelectCommonVol" />
        <refer refTo="LATcommonElectCount" />
      </mul>
    </add>
  </const>

  <const name="LATelectInnerVol" uType="none" >
    <notes>Volume of electronics boxes within the inner volume
       where cabling is most dense.  Includes 4 TEMs and the GASU
    </notes>
    <add>
      <mul>
        <const value="4" uType="count" />
        <refer refTo="TEMvol" />
      </mul>
      <refer refTo="GASUvol" />      
    </add>
  </const>

  <const name="LATelectInnerCuDensity" uType="none">
    <notes>1/2 Cu mass in gm/ (V(inner box) - V(inner elect) in cm**3)</notes>
    <quo>
      <half>
        <refer refTo="LATelectCableMass" />
      </half>
      <mul>
        <refer refTo="cubicmmToCubiccm" />
        <minus>
          <refer refTo="LATelectInnerCableEnvVol" />
          <refer refTo="LATelectInnerVol" />
        </minus>
      </mul>
    </quo>
  </const>
  
  <const name="LATelectOuterCuDensity" uType="none">
    <notes>1/2 Cu mass in gm / (V(env) - 
           (V(inner cable env) + V(peripheral elect) in cm**3)</notes>
    <quo>
      <half>
        <refer refTo="LATelectCableMass" />
      </half>
      <mul>
        <refer refTo="cubicmmToCubiccm" />
        <minus>
          <refer refTo="LATelectEnvVol" />
          <add>
            <refer refTo="LATelectInnerCableEnvVol" />
            <refer refTo="LATelectVol" />
            <uminus>
              <refer refTo="LATelectInnerVol" />
            </uminus>
          </add>
         </minus>
       </mul>
     </quo>
   </const>

   <const name="radiator_dyn">
     <notes>-Y radiator is symmetrically placed</notes>
     <uminus>
       <refer refTo="radiator_dy" />
     </uminus>
   </const>

   <const name="radiatorDensity">
     <notes>Computed density of a radiator from total mass and dimensions
     </notes>
     <quo>
       <refer refTo="radiatorMass" />
       <mul>
         <refer refTo="radiator_x" />
         <refer refTo="radiator_y" />
         <refer refTo="radiator_z" />
         <refer refTo="cubicmmToCubiccm" />
       </mul>
     </quo>
   </const>

   <const name="XLATdensity">
     <notes>Computed density of XLAT from total mass and dimensions
     </notes>
     <quo>
       <refer refTo="XLATmass" />
       <mul>
         <refer refTo="XLAT_t" />
         <refer refTo="XLAT_t" />
         <refer refTo="XLAT_z" />
         <refer refTo="cubicmmToCubiccm" />
       </mul>
     </quo>
   </const>

</derCategory>

<derCategory name="derSC" save="true" >
  <overview>Derived constants specific to spacecraft</overview>
  <const name="SCCornerSide">
    <notes>Length of corner sides of primary structure octagon.
           Let q = orthog. projection of side in, say x-direction,
           so side = sqrt(2)*q.  Then 2*q + 2*thick + SCBigSide = SCWidth,
           or q = 1/2(SCWidth-SCBigSide) - thick.</notes>
    <mul>
      <refer refTo="sqrt2" />
      <minus>
        <half>
          <minus>
            <refer refTo="SCWidth" />
            <refer refTo="SCBigSide" />
          </minus>
        </half>
        <refer refTo="SC_thick" />
      </minus>
    </mul>
  </const>

  <const name="tankInnerRadius" >
    <notes>Inner radius for hydrazine tank (and radius of 
      sphere of hydrazine propellant)</notes>
    <minus>
      <refer refTo="tankOuterRadius" />
      <refer refTo="tankThickness" />
    </minus>
  </const>

  <const name="skirt_dz">
    <notes>Z-displacement of skirt</notes>
    <minus>
      <refer refTo="radTop_dz" />
      <add>
        <refer refTo="skirtTop_to_radTop" />
        <half>
          <refer refTo="skirt_z" />
        </half>
      </add>
    </minus>
  </const>

  <const name="SCBigSide_dt" >
    <notes>Transverse displacement of +x or +y side of 
          primary structure</notes>
    <half>
      <minus>
        <refer refTo="SCWidth" />
        <refer refTo="SC_thick" />
      </minus>
    </half>
  </const>

  <const name="SCBigSide_dtn" >
    <notes>Transverse displacement of -x or -y side of primary 
        structure</notes>
    <uminus>
      <refer refTo="SCBigSide_dt" />
    </uminus>
  </const>

  <const name="SCBigSideClosest" >
    <notes>Transverse distance between nearest point of big side and origin
    </notes>
    <minus>
      <refer refTo="SCBigSide_dt" />
      <half>
        <refer refTo="SC_thick" />
      </half>
    </minus>
  </const>

  <const name="SCCorner_dt" >
    <notes>Transverse displacement t of 45-degree sides of primary structure.
     Can be computed in terms of (half-)length of big side B and 45-degree
     side b and displacement T of big side:&lt;br /&gt;
       t**2 = ((B/2)**2 + T**2) - (b/2)**2 is distance.  Then each coord.
       is this quantity / sqrt(2)
     This is displacement of closest point.  Then add 1/2 thickness to
     get displacement of middle.
    </notes>
    <add>
      <sqrt>
        <mul>
          <minus>
            <add>
              <mul>
                <refer refTo="SCBigSide" />
                <refer refTo="SCBigSide" />
                <const value="0.25" uType="count" />
              </mul>
              <mul>
                <refer refTo="SCBigSideClosest" />
                <refer refTo="SCBigSideClosest" />
              </mul>
            </add>
            <mul>
              <refer refTo="SCCornerSide" />
              <refer refTo="SCCornerSide" />
              <const value="0.25" uType="count" />
            </mul>
          </minus>
          <const value="0.5" uType="count" />
        </mul>
      </sqrt>
      <refer refTo="SC_thick" />
    </add>
  </const>


  <const name="SCCorner_dtn" >
    <notes>Neg. displacement for corner sides</notes>
    <uminus>
      <refer refTo="SCCorner_dt" />
    </uminus>
  </const>

  <const name="SCStruct_dz" >
    <notes>Z displacement for all 8 primary structure volumes.
    Roughly, top of skirt = top of primary structure.  May refine
    this later.     
    </notes>
    <minus>
      <refer refTo="skirt_dz" />
      <half>
        <minus>
          <refer refTo="SC_z" />
          <refer refTo="skirt_z" />
        </minus>
      </half>
    </minus>
  </const>

  <const name="avoidBattery_dz" >
    <notes>Try half of battery height</notes>
    <mul>
      <refer refTo="batteryBox_z" />
      <const value="0.5" uType="count" />
    </mul>
  </const>

  <const name="tank_dz" >
    <notes>vertical displacement for propellant tank and contents.
          Just assume it's somewhat above the bottom so avoid hitting
          battery. </notes>
    <add>
      <refer refTo="avoidBattery_dz" />
      <minus>
        <refer refTo="SCStruct_dz" />
        <minus>
          <half>
            <refer refTo="SC_z" />
          </half>
          <refer refTo="tankOuterRadius" />
        </minus>
      </minus>
     </add>
  </const>

  <const name="SC_HydrazineDensity" >
    <notes>Compute density in gm/cu cm given that tank of inner radius
      about 514 mm contains 350 kg of stuff</notes>
    <quo>
      <refer refTo="hydrazineMass" />
      <mul>
        <quo>
          <const value="4.0" />
          <const value="3.0" />
        </quo>
        <refer refTo="Pi" />
        <refer refTo="tankInnerRadius" />
        <refer refTo="tankInnerRadius" />
        <refer refTo="tankInnerRadius" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>    


  <const name="opticalBench_x" >
    <notes>Compute thickness from y and z dimensions, mass and
           density of aluminum</notes>
    <quo>
      <refer refTo="opticalBenchMass" />
      <mul>
        <refer refTo="opticalBench_y" />
        <refer refTo="opticalBench_z" />
        <refer refTo="cubicmmToCubiccm" />
        <refer refTo="NADelectAlDensity" /> 
      </mul>
    </quo>
  </const>


  <const name="opticalBench_dx" >
    <notes>Compute, assuming optical bench is just to the -X of 
           primary spacecraft structure and skirt</notes>
    <uminus>
      <half>
        <add>
          <refer refTo="skirtWidth" />
          <refer refTo="opticalBench_x" />
        </add>
      </half>
    </uminus>
  </const>

  <const name="opticalBench_dz" >
    <notes>Compute, assuming top of optical bench is level with
           top of primary spacecraft structure</notes>
    <add>
      <refer refTo="SCStruct_dz" />
      <half>
        <minus>
           <refer refTo="SC_z" />
           <refer refTo="opticalBench_z" />
        </minus>
      </half>
    </add>
  </const>   

<!-- Relating to spacecraft skirt -->
  <const name="skirtWidth" >
    <notes>Length of side of square enclosing skirt</notes>
    <add>
      <refer refTo="SCWidth" />
      <refer refTo="skirt_thick" />
      <refer refTo="skirt_thick" />
    </add>
  </const>

<!-- suppose ratio of skirt dimensions to skirt width = ratio
     of SC dimensions to SC width -->
  <const name="skirtBigSide_t " >
    <notes>Length of sides aligned with x or y axis</notes>
    <quo>
      <mul>
        <refer refTo="SCBigSide" />
        <refer refTo="skirtWidth" />
      </mul>
      <refer refTo="SCWidth" />
    </quo>
  </const>

  <const name="skirtCornerSide_t" >
    <notes>Length of corner sides of skirt</notes>
    <mul>
      <refer refTo="sqrt2" />
      <minus>
        <half>
          <minus>
            <refer refTo="skirtWidth" />
            <refer refTo="skirtBigSide_t" />
          </minus>
        </half>
        <refer refTo="skirt_thick" />
      </minus>
    </mul>
  </const>

  <const name="skirtBigSide_dt" >
    <notes>Transverse displacement of skirt sides aligned with X or Y</notes>
    <add>
      <refer refTo="SCBigSide_dt" />
      <half>
        <add>
          <refer refTo="SC_thick" />
          <refer refTo="skirt_thick" />
        </add>
      </half>
    </add>
  </const>

  <const name="skirtBigSide_dtn" >
    <notes>Transverse displacement of skirt sides aligned with X or Y</notes>
    <uminus>
      <refer refTo="skirtBigSide_dt" />
    </uminus>
  </const>

  <const name="skirtCorner_dt" >
    <notes>Transverse disp. of skirt sides clipping corner of square</notes>
    <add>
      <refer refTo="SCCorner_dt" />
      <quo>
        <half>
          <add>
            <refer refTo="SC_thick" />
            <refer refTo="skirt_thick" />
          </add>
        </half>
        <refer refTo="sqrt2" />
      </quo>
    </add>
  </const>

  <const name="skirtCorner_dtn" >
    <notes>Neg transverse disp of skirt sides clipping corner of square</notes>
    <uminus>
      <refer refTo="skirtCorner_dt" />
    </uminus>
  </const>

  <const name="skirtDensity" uType="none">
    <notes>Compute from volume and mass in grams. Result
           must be gm / cm**3 </notes>
    <quo>
      <refer refTo="skirtMass" />
      <mul>
        <add>
          <refer refTo="skirtBigSide_t" />
          <refer refTo="skirtCornerSide_t" />
        </add>
        <const value="4.0" uType="none" />
        <refer refTo="skirt_z" />
        <refer refTo="skirt_thick" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>

  <const name="solarPanel_dy" >
    <notes>y-displacement of panel-only part of solar panel w.r.t.
           envelope including panel and connecting rod</notes>
    <quo>
      <refer refTo="NADSolarRodLength" />
      <const value="2" uType="count" />
    </quo>
  </const>

  <const name="solarRod_dy" >
    <notes>y-displacement of rod part of solar panel w.r.t.
           envelope including panel and connecting rod</notes>
    <uminus>
      <quo>
        <refer refTo="NADSolarPLength" />
        <const value="2" uType="count" />
      </quo>
    </uminus>
  </const>

  <const name="solarPanelEnv_dy" >
    <notes>y-displacement of entire (+Y) solar panel envelope w.r.t.
           Ritz origin.</notes>
    <add>
      <refer refTo="radiator_dy" />
      <half>
        <add>
          <refer refTo="NADTotalPanelLen" />
          <refer refTo="radiator_y" />
        </add>
      </half>
    </add>
  </const>
  
  <const name="solarPanelEnv_dyn" >
    <notes>y-displacement of entire (-Y) solar panel envelope w.r.t.
           Ritz origin.</notes>
    <uminus>
      <refer refTo="solarPanelEnv_dy" />
    </uminus>
  </const>

  <!-- Put solar panels just halfway down the spacecraft -->
  <const name="solarPanelEnv_dz" >
    <notes>z-displacement of entire solar panel envelope w.r.t.
           Ritz origin.</notes>
     <refer refTo="SCStruct_dz" />
  </const>

  <const name="solarPanelSi_dz" >
    <notes>z-displacement of Si part of solar panel w.r.t.
           envelope including panel and connecting rod</notes>
    <quo>
      <refer refTo="NADSolarCoreThick" />
      <const value="2" uType="count" />
    </quo>
  </const>

  <const name="solarPanelCore_dz" >
    <notes>z-displacement of core part of solar panel w.r.t.
           envelope including panel and connecting rod</notes>
    <uminus>
      <quo>
        <refer refTo="NADSolarSiThick" />
        <const value="2" uType="count" />
      </quo>
    </uminus>
  </const>
    

  <const name="NADSolarRodDiam" >
    <notes>Diameter of rods connecting solar panels to spacecraft</notes>
    <add>
      <refer refTo="NADSolarRodR" />
      <refer refTo="NADSolarRodR" />
    </add>
  </const>

  <!-- Make up some dimensions for boxes to contain batteries. Make
       2 boxes, one near each of the Y-sides (sides with solar panels).
       Y-dimension appears to be about 1/4 full spacecraft width.
       X-dimension is somewhat larger.  Ratio is roughly 4 : 3.
       Z-dimension is about half of X-dimension.
    -->
  <const name="batteryBox_y" >
    <notes>Guess at Y-dimension of imaginary box containing half the
           spacecraft batteries.</notes>
    <mul>
      <refer refTo="SCWidth" />
      <const value="0.25" uType="count" />
    </mul>
  </const>

  <const name="batteryBox_x" >
    <notes>Guess at X-dimension of imaginary box containing half the
           spacecraft batteries.</notes>
    <quo>
      <refer refTo="batteryBox_y" />
      <const value="0.75" uType="count" />
    </quo>
  </const>

  <const name="batteryBox_z" >
    <notes>Guess at Z-dimension of imaginary box containing half the
           spacecraft batteries.</notes>
    <mul>
      <refer refTo="batteryBox_x" />
      <const value="0.5" uType="count" />
    </mul>
  </const>

  <const name="batteryBoxDensity" >
    <notes>Compute density in gram/cm**3 of made-up material
           for battery boxes</notes>
    <quo>
      <refer refTo="batteryBoxMass" />
      <mul>
        <refer refTo="batteryBox_x" />
        <refer refTo="batteryBox_y" />
        <refer refTo="batteryBox_z" />
        <refer refTo="cubicmmToCubiccm" />
      </mul>
    </quo>
  </const>

  <!-- Positioning of battery boxes.  Assume they're centered in X,
       sit on the "bottom" of SC in Z, and are adjacent to
       Y-walls of primary structure, on the inside  -->

  <const name="batteryBox_dz" >
    <notes> Z-displacement of battery boxes</notes>
    <minus>
      <refer refTo="SCStruct_dz" />
      <half>
        <minus>
          <refer refTo="SC_z" />
          <refer refTo="batteryBox_z" />
        </minus>
      </half>
    </minus>
  </const>

  <const name="batteryBox_dy" >
    <notes> Y-displacement of battery box near +Y side</notes>
    <minus>
      <refer refTo="SCBigSide_dt" />
      <half>
        <add>
          <refer refTo="SC_thick" />
          <refer refTo="batteryBox_y" />
        </add>
      </half>
    </minus>
  </const>

  <const name="batteryBox_dyn" >
    <notes> Y-displacement of battery box near -Y side</notes>
    <uminus>
      <refer refTo="batteryBox_dy" />
    </uminus>
  </const>
</derCategory>
