<!--  $Header: /nfs/slac/g/glast/ground/cvs/xmlGeoDbs/xml/flight/flightACDDerived.xml,v 1.2 2002/07/23 00:04:48 jrb Exp $ -->
      <derCategory name="derACD" save="true" >
        <overview>Derived constants specific to the ACD</overview>
        <const name="ACDTopTotalX">
          <notes>Total X width to be covered by top tiles</notes>
          <add>
            <refer refTo="towersTotalX" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="ACDTKRStayClear" />
            </mul>
          </add>
        </const>


        <const name="ACDTotalXSide" >
          <notes>total length (in x direction) to be covered by a 
                row of side tiles</notes>
          <add>
<!--            <refer refTo="towersTotalX" /> -->
            <refer refTo="ACDTopTotalX" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="ACDSideSupToTile" />
            </mul>
            <refer refTo="tileThickness" />
            <uminus>
               <refer refTo="topTileGap" />
            </uminus>
          </add>
        </const>

        <const name="ACDTotalX">
          <notes>max extent in x of all of ACD (not just top)</notes>
          <add>
            <refer refTo="ACDTotalXSide" />
            <refer refTo="tileThickness" />
            <refer refTo="topTileGap" />
            <mul>
              <const value="2" uType="count" />
              <add>
                <refer refTo="tapeThickness" />
                <refer refTo="tapeGap" />
              </add>
            </mul>
          </add>
        </const>

<!--
        <const name="ACDTotalX">
          <notes>max extent in x of all of ACD (not just top)</notes>
          <add>
            <refer refTo="ACDTopTotalX" />
            <mul>
              <const value="2" uType="count" />
              <add>
                <refer refTo="tileThickness" />
                <refer refTo="tapeThickness" />
                <refer refTo="tapeGap" />
                <refer refTo="ACDSideStandoff" />
              </add>
            </mul>
          </add>
        </const>
 -->

        <const name="XTopTileMax" uType="count" type="int">
          <notes>Convenience for idField definitons</notes>
          <minus>
            <refer refTo="numXTopTiles" />
            <const value="1.0" />
          </minus>
        </const>

        <const name="YTopTileMax" uType="count" type="int">
          <notes>Convenience for idField definitons</notes>
          <minus>
            <refer refTo="numYTopTiles" />
            <const value="1" uType="count" />
          </minus>
        </const>


        <const name="ACDShortRowMin" uType="count"  type="int">
          <notes>row number of first short ACD side row</notes>
          <add>
            <refer refTo="ACDLongRowMax" />
            <const value="1" uType="count" />
          </add>
        </const>

        <const name="ACDShortRowMax" uType="count"  type="int">
          <notes>row number of last short ACD side row</notes>
          <minus>
            <refer refTo="numSideRows" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="ACDShortMaxCol" uType="count" type="int">
          <notes>Column number of last tile in a short row</notes>
          <minus>
            <refer refTo="numPerSideRowShort" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="ACDLongMaxCol" uType="count" type="int">
          <notes>Column number of last tile in a long row</notes>
          <minus>
            <refer refTo="numPerSideRowLong" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="ACDTopXWidth">
          <notes>X dimension for a top tile. Must be derived from total width top and other things.  Tiles overlap in X.</notes>
          <quo>
            <add>
              <refer refTo="ACDTopTotalX"/>
              <mul>
                <refer refTo="XTopTileMax" />
                <refer refTo="topOverlap" />
              </mul>
            </add>
            <refer refTo="numXTopTiles" />
          </quo>
        </const>

        <const name="ACDTopYWidth">
          <notes>Y dimension for a top tile.  Derived from total width, size of gaps.</notes>
          <quo>
            <add>
              <refer refTo="ACDTopTotalY"/>
              <uminus>
                <mul>
                  <add>
                    <const value="1" uType="count" />
                    <refer refTo="numYTopTiles" />
                  </add>
                  <refer refTo="topTileGap" />
                </mul>
              </uminus>

            </add>
            <refer refTo="numYTopTiles" />
          </quo>
        </const>

<!-- Compute Z for the smallest box containing the top tiles + tape.
     From Heather's first diagram, this is

      3*tileThickness + tapeGap + tapeThickness

     May have to do this over for a box containing support as well,
     but so far have no information for support                   -->
        <const name="ACDTopZwidth" >
          <notes>Z for smallest box containing top tiles + tape (does
            not currently include support)</notes>
          <add>
            <mul>
              <const value="3" uType="count" /> <!-- (nRow+1)/2 -->
              <refer refTo="tileThickness" />
            </mul>
            <refer refTo="tapeGap" />
            <refer refTo="tapeThickness" />
          </add>
        </const>

<!-- following are convenient to have.. -->
        <const name = "sideOverlapToTopTape" >
          <notes>Distance from top of side tile to top of top tape</notes>
          <minus>
            <refer refTo="sideOverlap" />
            <add>
              <refer refTo="tapeThickness" />
              <refer refTo="tapeGap" />
            </add>
          </minus>
        </const>

        <const name="ACDTopZHalfWidth" >
          <notes>for convenience</notes>
          <quo>
            <refer refTo="ACDTopZwidth" />
            <const value="2" uType="count" />
          </quo>
        </const>

        <const name="tapeHalfThickness" >
          <notes>for convenience</notes>
          <quo>
            <refer refTo="tapeThickness" />
            <const value="2" uType="count" />
          </quo>
        </const>
<!-- thickness of side tiles + tape -->
        <const name="ACDSideThick">
          <notes>Tile thickness + tape thickness + gap (ACD sides)</notes>
          <add>
            <refer refTo="tileThickness" />
            <refer refTo="tapeThickness" />
            <refer refTo="tapeGap" />
          </add>
        </const>

        <const name="sideTileWidthShortXRow">
        <notes>to get width of an individual tile, take account of
              number of tiles in a row (and number of gaps)."Short"
              refers to the fact that the row has only 5 tiles</notes>
          <quo>
            <minus>
              <refer refTo="ACDTotalXSide" />
              <mul>
                <refer refTo="numPerSideRowShort" />
                <refer refTo="sideHorizontalGap" />
              </mul>
            </minus>
            <refer refTo="numPerSideRowShort" />
          </quo>
        </const>

        <const name="sideTileWidthLongXRow">
          <notes>Same as above for a long (10-tile) row</notes>
          <quo>
            <minus>
              <refer refTo="ACDTotalXSide" />
              <mul>
                <refer refTo="numPerSideRowLong" />
                <refer refTo="sideHorizontalGap" />
              </mul>
            </minus>
            <refer refTo="numPerSideRowLong" />
          </quo>
        </const>

<!-- Now do same for Y-direction -->
        <const name="ACDTopTotalY">
          <notes>Total Y width to be covered by top tiles</notes>
          <add>
            <refer refTo="towersTotalY" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="ACDTKRStayClear" />
            </mul>
          </add>
        </const>

        <const name="ACDTotalYSide" >
          <notes>Same as above but for Y sides (tiles)</notes>
          <add>
            <refer refTo="ACDTopTotalY" />
            <mul>
              <const value="2" uType="count" />
              <refer refTo="ACDSideSupToTile" />
            </mul>
            <refer refTo="tileThickness" />
            <uminus>
              <refer refTo="topTileGap"/>
            </uminus>
          </add>
        </const>

        <const name="ACDTotalY">
          <notes>max extent in y of all of ACD (not just top)</notes>
          <add>
            <refer refTo="ACDTotalYSide" />
            <refer refTo="tileThickness" />
            <refer refTo="topTileGap" />
            <mul>
              <const value="2" uType="count" />
              <add>
                <refer refTo="tapeThickness" />
                <refer refTo="tapeGap" />
              </add>
            </mul>
          </add>
        </const>


        <const name="ACDSideHeight" >
          <notes>Total height of an ACD side: tiles plus gaps</notes>
          <add>
            <refer refTo="sideTileHeight0" />
            <refer refTo="sideTileHeight1" />
            <refer refTo="sideTileHeight2" />
            <refer refTo="sideTileHeight3" />
            <mul>
              <minus>
                <refer refTo="numSideRows" />
                <const value="1" uType="count" />
              </minus>
              <refer refTo="sideVerticalGap" />
            </mul>
          </add>
        </const>

        <const name="sideTileWidthShortYRow">
          <notes>Same idea as for ACD X-side tiles</notes>
          <quo>
            <minus>
              <refer refTo="ACDTotalYSide" />
              <mul>
                <refer refTo="numPerSideRowShort" />
                <refer refTo="sideHorizontalGap" />
              </mul>
            </minus>
            <refer refTo="numPerSideRowShort" />
          </quo>
        </const>

        <const name="sideTileWidthLongYRow">
          <notes>Same idea as for ACD X-side tiles</notes>
          <quo>
            <minus>
              <refer refTo="ACDTotalYSide" />
              <mul>
                <refer refTo="numPerSideRowLong" />
                <refer refTo="sideHorizontalGap" />
              </mul>
            </minus>
            <refer refTo="numPerSideRowLong" />
          </quo>
        </const>
<!-- end Y side tile calculations -->

<!-- heights of tiles on both X and Y sides are the same: -->
        <const name="sideTileRow0_d">
          <notes>Z-Displacement for top row (row 0) of side tiles (X and Y),
                relative to the center of a box containing the side</notes>
          <quo>
            <minus>
              <refer refTo="ACDSideHeight" />
              <refer refTo="sideTileHeight0" />
            </minus>
            <const value="2" />
          </quo>
        </const>

        <const name="sideTileRow1_d">
          <notes>Displacement for row 1 side tiles (X and Y)</notes>
          <minus>
            <refer refTo="sideTileRow0_d" />
            <add>
              <refer refTo="sideVerticalGap" />
              <quo>
                <add>
                  <refer refTo="sideTileHeight1" />
                  <refer refTo="sideTileHeight0" />
                </add>
                <const value="2" uType="count" />
              </quo>
            </add>
          </minus>
        </const>

        <const name="sideTileRow2_d">
          <notes>Displacement for row 2 side tiles (X and Y)</notes>
          <minus>
            <refer refTo="sideTileRow1_d" />
            <add>
              <refer refTo="sideVerticalGap" />
              <quo>
                <add>
                  <refer refTo="sideTileHeight2" />
                  <refer refTo="sideTileHeight1" />
                </add>
                <const value="2" uType="count" />
              </quo>
            </add>
          </minus>
        </const>

        <const name="sideTileRow3_d">
          <notes>Displacement for row 3 side tiles (X and Y)</notes>
          <minus>
            <refer refTo="sideTileRow2_d" />
            <add>
              <refer refTo="sideVerticalGap" />
              <quo>
                <add>
                  <refer refTo="sideTileHeight3" />
                  <refer refTo="sideTileHeight2" />
                </add>
                <const value="2" uType="count" />
              </quo>
            </add>
          </minus>
        </const>

<!-- Now some stuff involving the ACD tape -->
        <const name="tapeSideLength">
          <notes>length of scintillating tape on a side (assume a single 
          piece going from top to bottom for now.  May want to shorten
          now that bottom tile "row" is just a single tile.</notes>
          <minus>
            <refer refTo="ACDSideHeight" />
            <refer refTo="sideOverlapToTopTape" />
          </minus>
        </const>

        <const name="topTapeLenLong" >
          <notes>lengths of tape convering gaps in the top.  There are
            3 different lengths to deal with the fact that tiles in
            different top rows are obscured differeng amounts by 
            overlap.  The longest tape goes over the outermost tiles,
            the shortest across the central row.  See Heather's 
            first diagram</notes>
          <add>
            <refer refTo="ACDTopXWidth" />
            <refer refTo="tapeTopExt" />
          </add>
        </const>
        <const name="topTapeLenMedium" >
          <notes>Length of top tapes for rows 1 and 3</notes>
          <minus>
            <refer refTo="topTapeLenLong" />
            <refer refTo="topOverlap" />
          </minus>
        </const>
        <const name="topTapeLenShort">
          <notes>Length of top tape for central row: row 2</notes>
          <minus>
            <refer refTo="ACDTopXWidth" />
            <mul>
              <const value="2" uType="count" />
               <add>
                 <refer refTo="topOverlap" />
                 <refer refTo="tapeTopExt" /> 
               </add>
            </mul>
          </minus>
        </const>

        <const name="topTapesPerRow" uType="count" type="int">
          <notes> Tapes on top come in columns, similar to tiles, except there
     is one less piece of tape than there are tiles in a row</notes>
          <minus>
            <refer refTo="numYTopTiles" />
            <const value="1" uType="count" />
          </minus>
        </const>

        <const name="topTapeGap" >
          <notes>gap between adjacent pieces of (top)tape in the 
          same row</notes>
          <add>
            <refer refTo="ACDTopYWidth" />
            <refer refTo="topTileGap" />
            <uminus>
              <refer refTo="tapeWidth" />
            </uminus>
          </add>
        </const>

<!-- Need to compute a bunch of displacements of top tapes relative to
     the "top ACD" envelope.  First do X, then Z.  Y displacements are
     all zero.  -->
        <const name="topTapeX4_d">
          <notes>x-displacement for a top tape in row 4
          relative to the "top ACD" envelope</notes>
          <mul>
            <const value="0.5" uType="count" />
            <minus>
              <refer refTo="ACDTopTotalX" />
              <refer refTo="topTapeLenLong" />
            </minus>
          </mul>
        </const>
        <const name="topTapeX3_d" >
          <notes>x-displacement for a top tape in  row 3</notes>
          <mul>
            <const value="0.5" uType="count" />
            <add>
              <refer refTo="topTapeLenShort" />
              <refer refTo="topTapeLenMedium" />
            </add>
          </mul>
        </const>
        <const name="topTapeX2_d" value="0.0">
          <notes>x-displacement for a top tape in  row 2</notes>
        </const>
        <const name="topTapeX1_d">
          <notes>x-displacement for a top tape in  row 1</notes>
          <uminus>
            <refer refTo="topTapeX3_d" />
          </uminus>
        </const>
        <const name="topTapeX0_d">
          <notes>x-displacement for a top tape in  row 0</notes>
          <uminus>
            <refer refTo="topTapeX4_d" />
          </uminus>
        </const>

        <const name="topTapeZLong_d" >
          <notes>Z displacement for a long (row 0 or 4) top tape</notes>
          <minus>
            <refer refTo="ACDTopZHalfWidth" />
            <refer refTo="tapeHalfThickness" />
          </minus>
        </const>

        <const name="topTapeZMedium_d" >
          <notes>Z displacement for a medium (row 1 or 3) top tape</notes>
          <minus>
            <refer refTo="topTapeZLong_d" />
            <refer refTo="tileThickness" />
          </minus>
        </const>

        <const name="topTapeZShort_d" >
          <notes>Z displacement for a top tape in row 2</notes>
          <minus>
            <refer refTo="topTapeZMedium_d" />
            <refer refTo="tileThickness" />
          </minus>
        </const>

        <const name="topTileZEdge_d" >
          <notes>Z displacement for a top tile in rows 0 or 4</notes>
          <minus>
            <mul>
              <const value="2.5" uType="count"  />
              <refer refTo="tileThickness" />
            </mul>
            <refer refTo="ACDTopZHalfWidth" />
          </minus>
        </const>

        <const name="topTileZMedium_d" >
          <notes>Z displacement for a top tile in rows 1 or 3</notes>
          <minus>
            <refer refTo="topTileZEdge_d" />
            <refer refTo="tileThickness" />
          </minus>
        </const>

        <const name="topTileZCenter_d" >
          <notes>Z displacement for a top tile in row 2</notes>
          <minus>
            <refer refTo="topTileZMedium_d" />
            <refer refTo="tileThickness" />
          </minus>
        </const>

        <const name="topTileX2_d"  value="0">
          <notes> middle row is centered in X</notes>
        </const>

        <const name="topTileX3_d" >
          <notes>X-displacement for a top tile in row 3</notes>
          <minus>
            <refer refTo="ACDTopXWidth" />
            <refer refTo="topOverlap" />
          </minus>
        </const>

        <const name="topTileX4_d" >
          <notes>X-displacement for a top tile in row 4</notes>
          <mul>
            <const value="2" uType="count"  />
            <refer refTo="topTileX3_d" />
          </mul>
        </const>

        <const name="topTileX0_d" >
          <notes>X-displacement for a top tile in row 0</notes>
          <uminus>
            <refer refTo="topTileX4_d" />
          </uminus>
        </const>

        <const name="topTileX1_d" >
          <notes>X-displacement for a top tile in row 1</notes>
          <uminus>
            <refer refTo="topTileX3_d" />
          </uminus>
        </const>

        <const name="betweenSideTapesX" >
          <notes>gap between two tapes on an ACD X-side</notes>
          <minus>
            <refer refTo="sideTileWidthLongXRow" />
            <refer refTo="tapeWidth" />
          </minus>
        </const>

        <const name="betweenSideTapesY" >
          <notes>gap between two tapes on an ACD Y-side</notes>
          <minus>
            <refer refTo="sideTileWidthLongYRow" />
            <refer refTo="tapeWidth" />
          </minus>
        </const>

        <const name="ACDSideDovetail_d" >
          <notes>Side tiles and tapes on sides parallel to X-axis
                 have a displacement in X of this amount. Those
                 on sides || to Y are displaced in Y the same amount</notes>
          <uminus>
            <quo>
              <add>
                <refer refTo="tileThickness" />
                <refer refTo="topTileGap" />
              </add>
              <const value="2" uType="count" />
            </quo>
          </uminus>
        </const>

        <const name="ACDSideDovetail_dn" >
          <notes>Dovetail displacement for "negative" ACD sides</notes>
          <uminus>
            <refer refTo="ACDSideDovetail_d" />
          </uminus>
        </const>
      </derCategory>
